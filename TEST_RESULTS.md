# Результаты тестирования реальных запросов

## Статус: ⚠️ Требуется ручное тестирование

### Проблема с автоматическим тестированием

Функция `confluence_semantic_search` обернута в декоратор `@mcp.tool()`, который превращает её в `FunctionTool` объект. Прямой вызов функции из Python скрипта невозможен без доступа к внутреннему механизму FastMCP.

### Рекомендуемый способ тестирования

#### Вариант 1: Через MCP клиент (Open WebUI, Claude Desktop)

1. Подключите MCP сервер к клиенту
2. Выполните запросы напрямую через интерфейс

#### Вариант 2: Через HTTP MCP протокол

```bash
# Тест 1: Учет номенклатуры
curl -X POST http://localhost:8012/mcp \
  -H "Content-Type: application/json" \
  -d '{
    "jsonrpc": "2.0",
    "id": "test-1",
    "method": "tools/call",
    "params": {
      "name": "confluence_semantic_search",
      "arguments": {
        "query": "Провожу обследование компании по блоку Склад, а точнее Учет номенклатуры. Подготовь список вопросов.",
        "limit": 20
      }
    }
  }'

# Тест 2: Технологический стек (с опечатками)
curl -X POST http://localhost:8012/mcp \
  -H "Content-Type: application/json" \
  -d '{
    "jsonrpc": "2.0",
    "id": "test-2",
    "method": "tools/call",
    "params": {
      "name": "confluence_semantic_search",
      "arguments": {
        "query": "Ккой тхнологиеский стек исользуется в проект рау ии.",
        "limit": 10,
        "space": "RAUII"
      }
    }
  }'
```

### Тестовые запросы

#### Тест 1: Учет номенклатуры
- **Запрос**: "Провожу обследование компании по блоку Склад, а точнее Учет номенклатуры. Подготовь список вопросов."
- **Ожидаемый результат**: 
  - Страница: `18153754` (Учет номенклатуры)
  - ~30+ вопросов из всех разделов
  - Ключевые слова: номенклатур, классификац, серии, характеристик, габарит, штрихкод

#### Тест 2: Технологический стек (с опечатками)
- **Запрос**: "Ккой тхнологиеский стек исользуется в проект рау ии."
- **Ожидаемый результат**:
  - Query Rewriting исправляет опечатки
  - Страница: `18153591` (Общая информация о проекте RAUII)
  - Показывает стек технологий
  - Ключевые слова: Ollama, OpenRouter, LiteLLM, MCP, технологи, стек

### Что проверить в результатах

1. **Количество результатов**: достаточно ли для полноты ответа?
2. **Релевантность**: правильные ли страницы в топе результатов?
3. **Query Rewriting**: видны ли в логах переписанные варианты запросов?
4. **Rerank scores**: какие значения получаем (должны быть в диапазоне 0.001-0.295)?
5. **Metadata boost**: помогает ли структурный поиск находить нужные страницы?
6. **Completeness**: возвращаются ли все вопросы со страницы или только часть?

### Следующие шаги

1. Выполнить тесты через MCP клиент или HTTP запросы
2. Проанализировать результаты
3. При необходимости скорректировать пороги reranking (`RERANK_THRESHOLD_TECHNICAL`, `RERANK_THRESHOLD_GENERAL`)
4. Проверить работу Query Rewriting в логах
