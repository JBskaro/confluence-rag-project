# üì¶ –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º

## üéØ –û–±–∑–æ—Ä

–ü—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **–º–æ–¥—É–ª—å–Ω—É—é —Å–∏—Å—Ç–µ–º—É –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π** –¥–ª—è –≥–∏–±–∫–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–∏:

```
requirements.txt          ‚Üê –ü–æ–ª–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ (–≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏)
‚îú‚îÄ‚îÄ requirements-core.txt  ‚Üê –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è (–±–µ–∑ ML)
‚îú‚îÄ‚îÄ requirements-ml.txt    ‚Üê ML –º–æ–¥–µ–ª–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
‚îî‚îÄ‚îÄ requirements-dev.txt   ‚Üê –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

pyproject.toml            ‚Üê PEP 517/518 (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
‚îî‚îÄ‚îÄ [project.optional-dependencies]
    ‚îú‚îÄ‚îÄ [ml]      ‚Üê torch, sentence-transformers
    ‚îú‚îÄ‚îÄ [openai]  ‚Üê OpenAI/OpenRouter API
    ‚îú‚îÄ‚îÄ [eval]    ‚Üê Ragas evaluation
    ‚îú‚îÄ‚îÄ [dev]     ‚Üê pytest, mypy, flake8, black
    ‚îî‚îÄ‚îÄ [all]     ‚Üê –≤—Å–µ –≤–º–µ—Å—Ç–µ
```

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π –≤—ã–±–æ—Ä

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: "–•–æ—á—É –±—ã—Å—Ç—Ä–æ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å"

```bash
pip install -r requirements-core.txt
```

‚úÖ –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –∑–∞ **2-3 –º–∏–Ω—É—Ç—ã**  
‚úÖ –†–∞–∑–º–µ—Ä: **~200MB**  
‚ö†Ô∏è –ù—É–∂–µ–Ω –≤–Ω–µ—à–Ω–∏–π API –¥–ª—è embeddings (Ollama/OpenRouter)

---

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: "Production —Å –ª–æ–∫–∞–ª—å–Ω—ã–º–∏ –º–æ–¥–µ–ª—è–º–∏"

```bash
pip install -r requirements.txt
```

‚úÖ –í—Å–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ (–≤–∫–ª—é—á–∞—è –ª–æ–∫–∞–ª—å–Ω—ã–µ embeddings)  
‚ö†Ô∏è –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –∑–∞ **10-20 –º–∏–Ω—É—Ç**  
‚ö†Ô∏è –†–∞–∑–º–µ—Ä: **~3-5GB**

---

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: "–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ —Å —Ç–µ—Å—Ç–∞–º–∏"

```bash
pip install -e .[dev]
```

‚úÖ Editable mode (–∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ä–∞–∑—É –≤–∏–¥–Ω—ã)  
‚úÖ pytest, mypy, flake8, black, isort  
‚úÖ –†–∞–∑–º–µ—Ä: **~300MB**

---

### –°—Ü–µ–Ω–∞—Ä–∏–π 4: "–¢–æ–ª—å–∫–æ —Ç–æ, —á—Ç–æ –Ω—É–∂–Ω–æ"

```bash
# Core + ML + OpenAI + Evaluation
pip install -e .[ml,openai,eval]

# Core + Dev (–±–µ–∑ ML)
pip install -e .[dev]

# –í—Å—ë –≤–º–µ—Å—Ç–µ
pip install -e .[all]
```

---

## üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤

### `requirements.txt` (–ø–æ–ª–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞)

**–ü–ª—é—Å—ã:**
- ‚úÖ –í—Å–µ —Ä–∞–±–æ—Ç–∞–µ—Ç out-of-the-box
- ‚úÖ –ù–µ –Ω—É–∂–Ω–æ –¥—É–º–∞—Ç—å –æ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è—Ö

**–ú–∏–Ω—É—Å—ã:**
- ‚ùå –î–æ–ª–≥–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ (10-20 –º–∏–Ω)
- ‚ùå –ë–æ–ª—å—à–æ–π —Ä–∞–∑–º–µ—Ä (~5GB)
- ‚ùå –ù–µ –Ω—É–∂–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (–µ—Å–ª–∏ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ ML)

**Use case:** Production —Å–µ—Ä–≤–µ—Ä —Å –ª–æ–∫–∞–ª—å–Ω—ã–º–∏ –º–æ–¥–µ–ª—è–º–∏

---

### `requirements-core.txt` (–º–∏–Ω–∏–º—É–º)

**–ü–ª—é—Å—ã:**
- ‚úÖ –ë—ã—Å—Ç—Ä–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ (2-3 –º–∏–Ω)
- ‚úÖ –õ–µ–≥–∫–æ–≤–µ—Å–Ω—ã–π (~200MB)
- ‚úÖ –ò–¥–µ–∞–ª—å–Ω–æ –¥–ª—è CI/CD

**–ú–∏–Ω—É—Å—ã:**
- ‚ùå –ù—É–∂–µ–Ω –≤–Ω–µ—à–Ω–∏–π API (Ollama/OpenRouter) –¥–ª—è embeddings
- ‚ùå –ù–µ—Ç Ragas evaluation

**Use case:** –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ, CI/CD, —Å–ª–∞–±—ã–π —Å–µ—Ä–≤–µ—Ä + –≤–Ω–µ—à–Ω–∏–π API

---

### `pyproject.toml` (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

**–ü–ª—é—Å—ã:**
- ‚úÖ PEP 517/518 —Å—Ç–∞–Ω–¥–∞—Ä—Ç
- ‚úÖ –ì–∏–±–∫–æ—Å—Ç—å (extras)
- ‚úÖ Editable install (`-e .`)
- ‚úÖ –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –ø–æ–¥—Ö–æ–¥

**–ú–∏–Ω—É—Å—ã:**
- ‚ùå –¢—Ä–µ–±—É–µ—Ç –ø–æ–Ω–∏–º–∞–Ω–∏—è extras

**Use case:** –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞, —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –ø—Ä–æ–µ–∫—Ç—ã

---

## üîß –î–µ—Ç–∞–ª—å–Ω–∞—è —Ä–∞–∑–±–∏–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

### Core (–≤—Å–µ–≥–¥–∞ –Ω—É–∂–Ω—ã)

| –ü–∞–∫–µ—Ç | –í–µ—Ä—Å–∏—è | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ | –†–∞–∑–º–µ—Ä |
|-------|--------|------------|--------|
| `fastmcp` | ‚â•0.2.0 | MCP server | ~5MB |
| `qdrant-client` | ‚â•1.11.0 | Vector DB | ~20MB |
| `pydantic` | ‚â•2.0.0 | Validation | ~10MB |
| `pydantic-settings` | ‚â•2.0.0 | Config | ~2MB |
| `httpx` | ‚â•0.27.0 | Async HTTP | ~15MB |
| `numpy` | ‚â•1.24.0 | Math | ~50MB |
| `rank_bm25` | ‚â•0.2.2 | Full-text search | ~1MB |
| `prometheus-client` | ‚â•0.17.0 | Metrics | ~5MB |

**–ò—Ç–æ–≥–æ: ~200MB**

---

### ML (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

| –ü–∞–∫–µ—Ç | –í–µ—Ä—Å–∏—è | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ | –†–∞–∑–º–µ—Ä |
|-------|--------|------------|--------|
| `torch` | ‚â•2.0.0 | Deep Learning | ~2GB |
| `sentence-transformers` | ‚â•2.7.0 | Embeddings | ~500MB |
| `huggingface-hub` | <1.0.0 | Model hub | ~50MB |
| `ragas` | latest | RAG eval | ~100MB |

**–ò—Ç–æ–≥–æ: ~3GB**

---

### Dev (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

| –ü–∞–∫–µ—Ç | –í–µ—Ä—Å–∏—è | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ | –†–∞–∑–º–µ—Ä |
|-------|--------|------------|--------|
| `pytest` | ‚â•8.0.0 | Testing | ~10MB |
| `mypy` | ‚â•1.7.0 | Type checking | ~15MB |
| `flake8` | ‚â•6.1.0 | Linting | ~5MB |
| `black` | ‚â•23.12.0 | Formatting | ~10MB |

**–ò—Ç–æ–≥–æ: ~100MB**

---

## üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è 1: CPU-only torch

–ï—Å–ª–∏ –Ω–µ –Ω—É–∂–µ–Ω GPU:

```bash
pip install torch --index-url https://download.pytorch.org/whl/cpu
```

**–≠–∫–æ–Ω–æ–º–∏—è:** ~1.5GB (2GB ‚Üí 500MB)

---

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è 2: –õ–µ–Ω–∏–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥–µ–ª–µ–π

–í `.env`:
```bash
# –ù–µ –∑–∞–≥—Ä—É–∂–∞—Ç—å –º–æ–¥–µ–ª–∏ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
LAZY_MODEL_LOADING=true
```

**–≠–∫–æ–Ω–æ–º–∏—è:** Faster startup, –º–µ–Ω—å—à–µ RAM

---

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è 3: Shared cache

–ï—Å–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø—Ä–æ–µ–∫—Ç–æ–≤ –∏—Å–ø–æ–ª—å–∑—É—é—Ç HuggingFace:

```bash
export HF_HOME=/shared/huggingface_cache
```

**–≠–∫–æ–Ω–æ–º–∏—è:** –ú–æ–¥–µ–ª–∏ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑

---

## üê≥ Docker –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è

### Multi-stage build

```dockerfile
# Stage 1: Core (200MB)
FROM python:3.11-slim as core
COPY requirements-core.txt .
RUN pip install --no-cache-dir -r requirements-core.txt

# Stage 2: ML (3GB) - –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
FROM core as ml
COPY requirements-ml.txt .
RUN pip install --no-cache-dir -r requirements-ml.txt

# Stage 3: App
FROM core as app  # –∏–ª–∏ FROM ml as app
COPY rag_server ./rag_server
CMD ["python", "-m", "rag_server.mcp_rag_secure"]
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- Core image: **500MB** (base + core)
- ML image: **3.5GB** (base + core + ML)

---

## üìù FAQ

### Q: –ö–∞–∫–æ–π —Ñ–∞–π–ª –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å?

**A:** –ó–∞–≤–∏—Å–∏—Ç –æ—Ç —Å—Ü–µ–Ω–∞—Ä–∏—è:
- **CI/CD:** `requirements-core.txt`
- **Dev –º–∞—à–∏–Ω–∞:** `pip install -e .[dev]`
- **Production (–º–æ—â–Ω—ã–π):** `requirements.txt`
- **Production (—Å–ª–∞–±—ã–π):** `requirements-core.txt` + external API

---

### Q: –ú–æ–∂–Ω–æ –ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `requirements.txt` + `pyproject.toml`?

**A:** –î–∞, –æ–Ω–∏ –Ω–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É—é—Ç:
- `requirements*.txt` - –¥–ª—è –ø—Ä–æ—Å—Ç–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–∏
- `pyproject.toml` - –¥–ª—è editable install –∏ —É–ø–∞–∫–æ–≤–∫–∏

---

### Q: –ö–∞–∫ –æ–±–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏?

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ
pip list --outdated

# –û–±–Ω–æ–≤–∏—Ç—å –≤—Å–µ
pip install --upgrade -r requirements.txt

# –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –ø–∞–∫–µ—Ç
pip install --upgrade qdrant-client
```

---

### Q: –ß—Ç–æ –¥–µ–ª–∞—Ç—å –ø—Ä–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π?

1. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ:
   ```bash
   python -m venv .venv
   source .venv/bin/activate
   ```

2. –û—á–∏—Å—Ç–∏—Ç–µ pip cache:
   ```bash
   pip cache purge
   ```

3. –ü–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ:
   ```bash
   pip install --force-reinstall -r requirements.txt
   ```

---

## üîÑ Migration guide

### –°–æ —Å—Ç–∞—Ä–æ–π –≤–µ—Ä—Å–∏–∏ (–±–µ–∑ extras)

**–ë—ã–ª–æ:**
```bash
pip install -r requirements.txt
```

**–°—Ç–∞–ª–æ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è):**
```bash
pip install -e .[ml,openai,eval]
```

**–ò–ª–∏ (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π):**
```bash
pip install -r requirements.txt  # –≤—Å—ë –µ—â—ë —Ä–∞–±–æ—Ç–∞–µ—Ç
```

---

## üéì Best practices

1. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ** (venv/virtualenv)
2. **–ó–∞–∫—Ä–µ–ø–ª—è–π—Ç–µ –≤–µ—Ä—Å–∏–∏** –≤ production (`==` –≤–º–µ—Å—Ç–æ `>=`)
3. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `pip-tools`** –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏
4. **–†–µ–≥—É–ª—è—Ä–Ω–æ –æ–±–Ω–æ–≤–ª—è–π—Ç–µ** –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (security patches)
5. **–¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è** –ø–µ—Ä–µ–¥ production

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- [INSTALLATION.md](INSTALLATION.md) - –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —É—Å—Ç–∞–Ω–æ–≤–∫–µ
- [pyproject.toml](../../pyproject.toml) - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞
- [CHANGELOG.md](../../CHANGELOG.md) - –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π
- [PEP 517](https://peps.python.org/pep-0517/) - Build system
- [PEP 518](https://peps.python.org/pep-0518/) - Dependency specification

---

**–ì–æ—Ç–æ–≤–æ!** üöÄ –¢–µ–ø–µ—Ä—å –≤—ã –∑–Ω–∞–µ—Ç–µ –≤—Å—ë –æ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è—Ö –ø—Ä–æ–µ–∫—Ç–∞.

