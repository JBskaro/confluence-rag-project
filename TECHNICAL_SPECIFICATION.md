# üìã –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ: MCP —Å–µ—Ä–≤–µ—Ä –¥–ª—è —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–æ–∏—Å–∫–∞ –ø–æ Confluence

## üéØ –¶–µ–ª—å –ø—Ä–æ–µ–∫—Ç–∞

–°–æ–∑–¥–∞—Ç—å MCP (Model Context Protocol) —Å–µ—Ä–≤–µ—Ä –¥–ª—è —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–æ–∏—Å–∫–∞ –ø–æ –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω–æ–π –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π Confluence —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –≤–µ–∫—Ç–æ—Ä–Ω–æ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö ChromaDB. –°–µ—Ä–≤–µ—Ä –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç:

1. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é** –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ Confluence —á–µ—Ä–µ–∑ REST API
2. **–°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫** –ø–æ –ø—Ä–æ–∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ —Å 12+ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è–º–∏
3. **Hybrid Search** (Vector + BM25) + **Re-Ranking** (Russian MS-MARCO) + **Fallback** –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏
4. **–ü–æ–¥–¥–µ—Ä–∂–∫—É MCP Streamable HTTP** –ø—Ä–æ—Ç–æ–∫–æ–ª–∞ –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å MCP-–∫–ª–∏–µ–Ω—Ç–∞–º–∏ (Open WebUI, Claude Desktop, Cursor IDE)
5. **Self-learning —Å–∏—Å—Ç–µ–º—É** —Å–∏–Ω–æ–Ω–∏–º–æ–≤ –∏ —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –∫—ç—à –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–µ—à–µ–Ω–∏—è

### –û–±—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                   –í–Ω–µ—à–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç—ã                    ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ Open WebUI   ‚îÇ  ‚îÇ Claude       ‚îÇ  ‚îÇ Cursor    ‚îÇ ‚îÇ
‚îÇ  ‚îÇ (MCP)        ‚îÇ  ‚îÇ Desktop     ‚îÇ  ‚îÇ IDE       ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
          ‚îÇ                  ‚îÇ                 ‚îÇ
          ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                     ‚îÇ HTTP/JSON-RPC 2.0
                     ‚îÇ
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ   FastMCP Server (–ø–æ—Ä—Ç 8012)               ‚îÇ
    ‚îÇ   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
    ‚îÇ   ‚îÇ  MCP Protocol (streamable-http)    ‚îÇ   ‚îÇ
    ‚îÇ   ‚îÇ  - POST /mcp (JSON-RPC 2.0)        ‚îÇ   ‚îÇ
    ‚îÇ   ‚îÇ  - Server-Sent Events (SSE)       ‚îÇ   ‚îÇ
    ‚îÇ   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
    ‚îÇ   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
    ‚îÇ   ‚îÇ  Tool: confluence_semantic_search   ‚îÇ   ‚îÇ
    ‚îÇ   ‚îÇ  - Semantic Caching                ‚îÇ   ‚îÇ
    ‚îÇ   ‚îÇ  - Query Expansion (4 –∏—Å—Ç–æ—á–Ω–∏–∫–∞)    ‚îÇ   ‚îÇ
    ‚îÇ   ‚îÇ  - Query Intent Classification      ‚îÇ   ‚îÇ
    ‚îÇ   ‚îÇ  - Multi-Query Search               ‚îÇ   ‚îÇ
    ‚îÇ   ‚îÇ  - Metadata Pre-filtering           ‚îÇ   ‚îÇ
    ‚îÇ   ‚îÇ  - Hybrid Search (Vector + BM25)    ‚îÇ   ‚îÇ
    ‚îÇ   ‚îÇ  - CrossEncoder Reranking           ‚îÇ   ‚îÇ
    ‚îÇ   ‚îÇ  - Context Expansion                 ‚îÇ   ‚îÇ
    ‚îÇ   ‚îÇ  - Hierarchy Boost                   ‚îÇ   ‚îÇ
    ‚îÇ   ‚îÇ  - Breadcrumb Matching               ‚îÇ   ‚îÇ
    ‚îÇ   ‚îÇ  - Fallback Search (3 —É—Ä–æ–≤–Ω—è)        ‚îÇ   ‚îÇ
    ‚îÇ   ‚îÇ  - PRF (Pseudo-Relevance Feedback)   ‚îÇ   ‚îÇ
    ‚îÇ   ‚îÇ  - Content Type Detection             ‚îÇ   ‚îÇ
    ‚îÇ   ‚îÇ  - Diversity Filter                   ‚îÇ   ‚îÇ
    ‚îÇ   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
    ‚îÇ   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
    ‚îÇ   ‚îÇ  Tool: confluence_health            ‚îÇ   ‚îÇ
    ‚îÇ   ‚îÇ  - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –∏–Ω–¥–µ–∫—Å–∞        ‚îÇ   ‚îÇ
    ‚îÇ   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                   ‚îÇ
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ   Vector Database Layer                    ‚îÇ
    ‚îÇ   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
    ‚îÇ   ‚îÇ  ChromaDB (Persistent)             ‚îÇ   ‚îÇ
    ‚îÇ   ‚îÇ  - Collection: confluence          ‚îÇ   ‚îÇ
    ‚îÇ   ‚îÇ  - Embeddings + Metadata           ‚îÇ   ‚îÇ
    ‚îÇ   ‚îÇ  - Metadata filtering (space, etc.) ‚îÇ   ‚îÇ
    ‚îÇ   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                   ‚îÇ
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ   Embedding Model Layer                   ‚îÇ
    ‚îÇ   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
    ‚îÇ   ‚îÇ  Fallback Strategy:                ‚îÇ   ‚îÇ
    ‚îÇ   ‚îÇ  1. Ollama (–µ—Å–ª–∏ USE_OLLAMA=true)  ‚îÇ   ‚îÇ
    ‚îÇ   ‚îÇ     (nomic-embed-text, etc.)       ‚îÇ   ‚îÇ
    ‚îÇ   ‚îÇ  2. HuggingFace (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)     ‚îÇ   ‚îÇ
    ‚îÇ   ‚îÇ     (ai-forever/FRIDA)             ‚îÇ   ‚îÇ
    ‚îÇ   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                   ‚îÇ
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ   Confluence Sync Layer                     ‚îÇ
    ‚îÇ   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
    ‚îÇ   ‚îÇ  Sync Service (sync.py):            ‚îÇ   ‚îÇ
    ‚îÇ   ‚îÇ  - REST API Confluence               ‚îÇ   ‚îÇ
    ‚îÇ   ‚îÇ  - –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è     ‚îÇ   ‚îÇ
    ‚îÇ   ‚îÇ  - Smart Chunking (–∏–µ—Ä–∞—Ä—Ö–∏—è)         ‚îÇ   ‚îÇ
    ‚îÇ   ‚îÇ  - Batch processing                  ‚îÇ   ‚îÇ
    ‚îÇ   ‚îÇ  - –ê–≤—Ç–æ—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è (–∫–∞–∂–¥—ã–π —á–∞—Å)   ‚îÇ   ‚îÇ
    ‚îÇ   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                   ‚îÇ
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ   Confluence Cloud/Server                   ‚îÇ
    ‚îÇ   (REST API)                                ‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üì¶ –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã

### 1. **FastMCP Server** (–æ—Å–Ω–æ–≤–Ω–æ–π —Å–µ—Ä–≤–µ—Ä)

**–§–∞–π–ª**: `rag_server/mcp_rag_secure.py` (1585 —Å—Ç—Ä–æ–∫)

**–§—É–Ω–∫—Ü–∏–∏**:
- –†–µ–∞–ª–∏–∑–∞—Ü–∏—è MCP –ø—Ä–æ—Ç–æ–∫–æ–ª–∞ —á–µ—Ä–µ–∑ FastMCP
- –û–±—Ä–∞–±–æ—Ç–∫–∞ JSON-RPC 2.0 –∑–∞–ø—Ä–æ—Å–æ–≤
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ streamable-http —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤—Å–µ—Ö –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π –ø–æ–∏—Å–∫–∞
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∂–∏–∑–Ω–µ–Ω–Ω—ã–º —Ü–∏–∫–ª–æ–º –≤–µ–∫—Ç–æ—Ä–Ω–æ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

**–ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç–æ–¥—ã**:

#### –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è:
- `init_rag()` ‚Äî –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è ChromaDB, StorageContext, VectorStoreIndex
- Eager loading –º–æ–¥–µ–ª–∏ –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ –º–æ–¥—É–ª—è (–Ω–∞ —É—Ä–æ–≤–Ω–µ –º–æ–¥—É–ª—è)
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ embedding –º–æ–¥–µ–ª–µ–π —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –±–∞–∑–æ–π
- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö: `collection`, `storage_context`, `index`

#### Tool: `confluence_semantic_search`
- **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**:
  - `query` (str, –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π): –¢–µ–∫—Å—Ç–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å –¥–ª—è –ø–æ–∏—Å–∫–∞ (2-1000 —Å–∏–º–≤–æ–ª–æ–≤)
  - `limit` (int, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ): –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ (1-20, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 5)
  - `space` (str, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ): –§–∏–ª—å—Ç—Ä –ø–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤—É Confluence
- **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å**:
  - Semantic Caching (–ø—Ä–æ–≤–µ—Ä–∫–∞ –∫—ç—à–∞ –ø–µ—Ä–µ–¥ –ø–æ–∏—Å–∫–æ–º)
  - Query Intent Classification (navigational, howto, factual, exploratory)
  - Query Expansion (4 –∏—Å—Ç–æ—á–Ω–∏–∫–∞ —Å–∏–Ω–æ–Ω–∏–º–æ–≤)
  - Multi-Query Search (–ø–æ–∏—Å–∫ –ø–æ –Ω–µ—Å–∫–æ–ª—å–∫–∏–º –≤–∞—Ä–∏–∞–Ω—Ç–∞–º –∑–∞–ø—Ä–æ—Å–∞)
  - Metadata Pre-filtering (—Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ space –î–û –≤–µ–∫—Ç–æ—Ä–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞)
  - Hybrid Search (Vector + BM25 —á–µ—Ä–µ–∑ RRF)
  - Deduplication (—É–¥–∞–ª–µ–Ω–∏–µ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤)
  - CrossEncoder Reranking (Russian MS-MARCO –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
  - Context Expansion (—Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ —Å–æ—Å–µ–¥–Ω–∏–º–∏ —á–∞–Ω–∫–∞–º–∏)
  - Hierarchy Boost (—É—á–µ—Ç –≤–∞–∂–Ω–æ—Å—Ç–∏ —Å—Ç—Ä–∞–Ω–∏—Ü)
  - Breadcrumb Matching (—Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞ —Å –ø—É—Ç–µ–º –¥–æ–∫—É–º–µ–Ω—Ç–∞)
  - Fallback Search (3 —É—Ä–æ–≤–Ω—è: —É–±—Ä–∞—Ç—å space, PRF, —Å–Ω–∏–∑–∏—Ç—å –ø–æ—Ä–æ–≥)
  - Content Type Detection (—Ç–∞–±–ª–∏—Ü—ã, —Å–ø–∏—Å–∫–∏, –∫–æ–¥, —Ç–µ–∫—Å—Ç)
  - Diversity Filter (–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —á–∞–Ω–∫–æ–≤ —Å –æ–¥–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã)
  - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –∫—ç—à –ø–æ—Å–ª–µ –ø–æ–∏—Å–∫–∞
  - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –¥–ª—è Query Mining

#### Tool: `confluence_health`
- **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç**: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –≤ –±–∞–∑–µ, —Å—Ç–∞—Ç—É—Å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∑–∞–ø—É—Å–∫–∞**:
```python
mcp = FastMCP("Confluence RAG")
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ HTTP —Å–µ—Ä–≤–µ—Ä–∞ –Ω–∞ –ø–æ—Ä—Ç—É 8012
```

---

### 2. **Vector Database** (ChromaDB)

**–§–∞–π–ª**: `rag_server/mcp_rag_secure.py` (—Ñ—É–Ω–∫—Ü–∏—è `init_rag()`)

**–§—É–Ω–∫—Ü–∏–∏**:
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ ChromaDB –∫–æ–ª–ª–µ–∫—Ü–∏–µ–π
- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ embedding –º–æ–¥–µ–ª–µ–π
- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ —Å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏
- –í–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫ —Å —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è–º–∏
- –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ (–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤)

**–ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç–æ–¥—ã**:
- `init_rag()` ‚Äî –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è ChromaDB —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ –º–æ–¥–µ–ª–µ–π
- `collection.query()` ‚Äî –≤–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫ –ø–æ –∑–∞–ø—Ä–æ—Å—É
- `collection.count()` ‚Äî –ø–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –≤ –∫–æ–ª–ª–µ–∫—Ü–∏–∏

**–ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –∫–æ–ª–ª–µ–∫—Ü–∏–∏**:
- `space` ‚Äî –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ Confluence
- `page_id` ‚Äî ID —Å—Ç—Ä–∞–Ω–∏—Ü—ã
- `page_title` ‚Äî –∑–∞–≥–æ–ª–æ–≤–æ–∫ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
- `page_path` ‚Äî –ø–æ–ª–Ω—ã–π –ø—É—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—ã (–∏–µ—Ä–∞—Ä—Ö–∏—è: "Parent > Child > Current")
- `breadcrumb` ‚Äî –ø—É—Ç—å –∫ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
- `parent_id` ‚Äî ID —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
- `parent_title` ‚Äî –∑–∞–≥–æ–ª–æ–≤–æ–∫ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
- `labels` ‚Äî –º–µ—Ç–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
- `chunk_index` ‚Äî –∏–Ω–¥–µ–∫—Å —á–∞–Ω–∫–∞ –≤ –¥–æ–∫—É–º–µ–Ω—Ç–µ
- `hierarchy_level` ‚Äî —É—Ä–æ–≤–µ–Ω—å –≤ –∏–µ—Ä–∞—Ä—Ö–∏–∏ (H1, H2, etc.)
- `type` ‚Äî —Ç–∏–ø –±–ª–æ–∫–∞ (table, list, text)
- `parent_path` ‚Äî –ø—É—Ç—å –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ –≤–Ω—É—Ç—Ä–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
- `is_complete_block` ‚Äî —Ñ–ª–∞–≥ –ø–æ–ª–Ω–æ–≥–æ –±–ª–æ–∫–∞ (—Ç–∞–±–ª–∏—Ü—ã/—Å–ø–∏—Å–∫–∏ –Ω–µ —Ä–∞–∑–±–∏–≤–∞—é—Ç—Å—è)
- `has_table` ‚Äî –Ω–∞–ª–∏—á–∏–µ —Ç–∞–±–ª–∏—Ü—ã –≤ —á–∞–Ω–∫–µ
- `heading_path` ‚Äî –ø–æ–ª–Ω—ã–π –ø—É—Ç—å –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**:
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ embedding –º–æ–¥–µ–ª–µ–π
- –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –ø—Ä–∏ —Å–º–µ–Ω–µ –º–æ–¥–µ–ª–∏ (—Ç—Ä–µ–±—É–µ—Ç –ø–µ—Ä–µ–∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏)
- –ü–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –≤ `CHROMA_PATH`

---

### 3. **Confluence Sync Service** (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è)

**–§–∞–π–ª**: `rag_server/sync_confluence_optimized_final.py` (1347 —Å—Ç—Ä–æ–∫)

**–§—É–Ω–∫—Ü–∏–∏**:
- –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü Confluence —á–µ—Ä–µ–∑ REST API
- –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ (—Ç–æ–ª—å–∫–æ –∏–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã)
- –ü–∞—Ä—Å–∏–Ω–≥ HTML –∫–æ–Ω—Ç–µ–Ω—Ç–∞ —Å—Ç—Ä–∞–Ω–∏—Ü —á–µ—Ä–µ–∑ BeautifulSoup
- Structural Chunking (—Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü, —Å–ø–∏—Å–∫–æ–≤, –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ –∫–∞–∫ –∞—Ç–æ–º–∞—Ä–Ω—ã—Ö –µ–¥–∏–Ω–∏—Ü)
- –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –∏ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ markdown
- –£–º–Ω—ã–π chunking —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –∏–µ—Ä–∞—Ä—Ö–∏–∏ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤
- –ü–∞–∫–µ—Ç–Ω–∞—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è –≤ ChromaDB
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é

**–ö–ª—é—á–µ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏**:

#### `sync_confluence()`
- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Confluence REST API
- –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ spaces (—Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π –ø–æ `CONFLUENCE_SPACE_FILTER`)
- –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü –¥–ª—è –∫–∞–∂–¥–æ–≥–æ space
- –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è (–ø—Ä–æ–≤–µ—Ä–∫–∞ `last_modified`)
- –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü –±–∞—Ç—á–∞–º–∏ (–ø–æ `BATCH_SIZE`)

#### `process_page()`
- –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã —á–µ—Ä–µ–∑ REST API
- –ü–∞—Ä—Å–∏–Ω–≥ HTML —á–µ—Ä–µ–∑ BeautifulSoup
- –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π —Ä–∞–∑–ª–∏—á–Ω—ã—Ö encodings
- –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ markdown —á–µ—Ä–µ–∑ `markdownify`
- –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö (title, breadcrumb, labels, parent_id)

#### `extract_structural_blocks()` –∏ `smart_chunk_with_context()`
- Structural Chunking: —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –ª–æ–≥–∏—á–µ—Å–∫–∏—Ö –±–ª–æ–∫–æ–≤ (—Ç–∞–±–ª–∏—Ü—ã, —Å–ø–∏—Å–∫–∏, –∑–∞–≥–æ–ª–æ–≤–∫–∏, —Ç–µ–∫—Å—Ç)
- –¢–∞–±–ª–∏—Ü—ã –∏ —Å–ø–∏—Å–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –∫–∞–∫ –∞—Ç–æ–º–∞—Ä–Ω—ã–µ –µ–¥–∏–Ω–∏—Ü—ã (–Ω–µ —Ä–∞–∑–±–∏–≤–∞—é—Ç—Å—è)
- –¢–µ–∫—Å—Ç–æ–≤—ã–µ –±–ª–æ–∫–∏ —Ä–∞–∑–±–∏–≤–∞—é—Ç—Å—è –ø–æ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è–º —Å overlap
- –†–∞–∑–º–µ—Ä —á–∞–Ω–∫–∞: `MAX_CHUNK_SIZE` —Å–∏–º–≤–æ–ª–æ–≤ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 1000)
- –ü–µ—Ä–µ–∫—Ä—ã—Ç–∏–µ: `CHUNK_OVERLAP` —Å–∏–º–≤–æ–ª–æ–≤ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 100)
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ (H1, H2, H3) –≤ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ–ª–Ω–æ–≥–æ –ø—É—Ç–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã (`page_path`) –∏ –ø—É—Ç–∏ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ (`parent_path`)
- –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è –∏–µ—Ä–∞—Ä—Ö–∏–∏

#### `start_sync_loop()`
- –ì–ª–∞–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
- –ó–∞–ø—É—Å–∫ –≤ —Ñ–æ–Ω–æ–≤–æ–º –ø–æ—Ç–æ–∫–µ
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∫–∞–∂–¥—ã–µ `SYNC_INTERVAL` —Å–µ–∫—É–Ω–¥
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**:
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ (–ø–µ—Ä–≤–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è)
- –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ (—Ç–æ–ª—å–∫–æ –∏–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã)
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ spaces
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∫–æ–¥–∏—Ä–æ–≤–∫–∏ —Ñ–∞–π–ª–æ–≤
- –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä—ã –¥–ª—è –±–æ–ª—å—à–∏—Ö –±–∞—Ç—á–µ–π
- –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–æ–º–µ–Ω–Ω—ã—Ö —Ç–µ—Ä–º–∏–Ω–æ–≤ –∏–∑ Confluence (–¥–ª—è SynonymsManager)

---

### 4. **Embedding Model Management** (—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–æ–¥–µ–ª—è–º–∏)

**–§–∞–π–ª**: `rag_server/embeddings.py`

**–§—É–Ω–∫—Ü–∏–∏**:
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ embedding –º–æ–¥–µ–ª—è–º–∏ (HuggingFace, Ollama, OpenAI-compatible API)
- –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–π –≤—ã–±–æ—Ä: OpenAI-compatible API ‚Üí Ollama ‚Üí HuggingFace
- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è –º–æ–¥–µ–ª–µ–π
- –°–æ–∑–¥–∞–Ω–∏–µ embeddings –¥–ª—è —Ç–µ–∫—Å—Ç–æ–≤ (–æ–¥–∏–Ω–æ—á–Ω—ã—Ö –∏ –±–∞—Ç—á–µ–π)
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Ä–∞–∑–º–µ—Ä–Ω–æ—Å—Ç–∏
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ OpenRouter, Ollama, LM Studio –∏ –¥—Ä—É–≥–∏—Ö OpenAI-compatible API

**–ö–ª—é—á–µ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏**:

#### `get_embed_model()`
- –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1: OpenAI-compatible API (–µ—Å–ª–∏ `OPENAI_API_BASE` —É–∫–∞–∑–∞–Ω)
- –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2: Ollama —á–µ—Ä–µ–∑ LlamaIndex (–µ—Å–ª–∏ `USE_OLLAMA=true`)
- –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3: HuggingFace (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
- –°—Ç—Ä–æ–≥–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –±–µ–∑ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ fallback (–ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –Ω–µ—Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Ä–∞–∑–º–µ—Ä–Ω–æ—Å—Ç–∏)
- –õ–µ–Ω–∏–≤–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è (–º–æ–¥–µ–ª—å –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑)
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–∏ –≤ –≥–ª–æ–±–∞–ª—å–Ω–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π

#### `generate_query_embedding()`
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è embedding –¥–ª—è –æ–¥–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ç–µ–∫—É—â–µ–π –º–æ–¥–µ–ª–∏ (Ollama –∏–ª–∏ HuggingFace)

#### `generate_query_embeddings_batch()`
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è embeddings –¥–ª—è –±–∞—Ç—á–∞ –∑–∞–ø—Ä–æ—Å–æ–≤
- –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è –±–∞—Ç—á–µ–≤–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏

#### `validate_collection_dimension()`
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Ä–∞–∑–º–µ—Ä–Ω–æ—Å—Ç–∏ embeddings
- –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –ø—Ä–∏ –Ω–µ—Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏

**–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –º–æ–¥–µ–ª–∏**:
- **OpenAI-compatible API**: –ª—é–±—ã–µ –º–æ–¥–µ–ª–∏ —á–µ—Ä–µ–∑ OpenRouter, Ollama, LM Studio –∏ –¥—Ä.
  - –ü—Ä–∏–º–µ—Ä—ã: `qwen/qwen3-embedding-8b`, `text-embedding-ada-002`, `nomic-embed-text`
- **Ollama —á–µ—Ä–µ–∑ LlamaIndex**: `nomic-embed-text`, `all-minilm` –∏ –¥—Ä—É–≥–∏–µ
- **HuggingFace**: `ai-forever/FRIDA` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, —Ä—É—Å—Å–∫–∏–π —è–∑—ã–∫)

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**:
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ GPU/CPU
- –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ GPU
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–µ–π –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è –ø–æ—Å–ª–µ–¥—É—é—â–∏—Ö –∑–∞–ø—É—Å–∫–æ–≤
- Eager loading –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ –º–æ–¥—É–ª—è

---

### 5. **Synonyms Manager** (—Å–∞–º–æ–æ–±—É—á–∞—é—â–∞—è—Å—è —Å–∏—Å—Ç–µ–º–∞ —Å–∏–Ω–æ–Ω–∏–º–æ–≤)

**–§–∞–π–ª**: `rag_server/synonyms_manager.py` (400 —Å—Ç—Ä–æ–∫)

**–§—É–Ω–∫—Ü–∏–∏**:
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∏–Ω–æ–Ω–∏–º–∞–º–∏ –∏–∑ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–æ–º–µ–Ω–Ω—ã—Ö —Ç–µ—Ä–º–∏–Ω–æ–≤ –∏–∑ Confluence
- Query Mining (–æ–±—É—á–µ–Ω–∏–µ –Ω–∞ –∑–∞–ø—Ä–æ—Å–∞—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)
- –≠–∫—Å–ø–æ—Ä—Ç –≤—ã—É—á–µ–Ω–Ω—ã—Ö —Å–∏–Ω–æ–Ω–∏–º–æ–≤

**–ö–ª–∞—Å—Å—ã**:

#### `SynonymsManager`
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤—Å–µ–º–∏ –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º–∏ —Å–∏–Ω–æ–Ω–∏–º–æ–≤
- –ú–µ—Ç–æ–¥—ã: `get_synonyms()`, `extract_domain_terms_from_confluence()`, `log_query()`

#### `QueryMiner`
- –û–±—É—á–µ–Ω–∏–µ –Ω–∞ –∑–∞–ø—Ä–æ—Å–∞—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –≥—Ä–∞—Ñ–∞ —Å–æ–≤–º–µ—Å—Ç–Ω–æ–π –≤—Å—Ç—Ä–µ—á–∞–µ–º–æ—Å—Ç–∏ —Ç–µ—Ä–º–∏–Ω–æ–≤
- –ù–∞—Ö–æ–∂–¥–µ–Ω–∏–µ —Å–∏–Ω–æ–Ω–∏–º–æ–≤ —á–µ—Ä–µ–∑ Jaccard similarity

**–ò—Å—Ç–æ—á–Ω–∏–∫–∏ —Å–∏–Ω–æ–Ω–∏–º–æ–≤**:
1. **–ë–∞–∑–æ–≤—ã–π —Å–ª–æ–≤–∞—Ä—å** (50 –æ–±—â–∏—Ö IT-—Ç–µ—Ä–º–∏–Ω–æ–≤) ‚Äî —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π
2. **–î–æ–º–µ–Ω–Ω—ã–µ —Ç–µ—Ä–º–∏–Ω—ã** ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–∑ Confluence (spaces, –∞–±–±—Ä–µ–≤–∏–∞—Ç—É—Ä—ã)
3. **–í—ã—É—á–µ–Ω–Ω—ã–µ —Å–∏–Ω–æ–Ω–∏–º—ã** ‚Äî Query Mining (–≥—Ä–∞—Ñ —Å–æ–≤–º–µ—Å—Ç–Ω–æ–π –≤—Å—Ç—Ä–µ—á–∞–µ–º–æ—Å—Ç–∏)
4. **Ollama** (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) ‚Äî —á–µ—Ä–µ–∑ `rewrite_query_with_ollama()`

**–§–∞–π–ª—ã –¥–∞–Ω–Ω—ã—Ö**:
```
data/
  ‚îú‚îÄ‚îÄ domain_terms.json        # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–∑–≤–ª–µ—á–µ–Ω–Ω—ã–µ —Ç–µ—Ä–º–∏–Ω—ã
  ‚îú‚îÄ‚îÄ learned_synonyms.json     # –í—ã—É—á–µ–Ω–Ω—ã–µ —Å–∏–Ω–æ–Ω–∏–º—ã
  ‚îî‚îÄ‚îÄ query_log.json           # –ò—Å—Ç–æ—Ä–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 1000)
```

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**:
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–æ–º–µ–Ω–Ω—ã—Ö —Ç–µ—Ä–º–∏–Ω–æ–≤ –ø—Ä–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –¥–ª—è –æ–±—É—á–µ–Ω–∏—è
- –≠–∫—Å–ø–æ—Ä—Ç –≤—ã—É—á–µ–Ω–Ω—ã—Ö —Å–∏–Ω–æ–Ω–∏–º–æ–≤ –≤ JSON
- –ó–∞—â–∏—Ç–∞ –æ—Ç –∑–∞–º–µ–Ω—ã blacklist —Ç–µ—Ä–º–∏–Ω–æ–≤ (—Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ –∏–º–µ–Ω–∞, –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã)

---

### 6. **Semantic Cache** (–≥–∏–±—Ä–∏–¥–Ω—ã–π –∫—ç—à)

**–§–∞–π–ª**: `rag_server/semantic_cache.py` (250 —Å—Ç—Ä–æ–∫)

**–§—É–Ω–∫—Ü–∏–∏**:
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ–∏—Å–∫–∞ –¥–ª—è —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏ –ø–æ—Ö–æ–∂–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- –ì–∏–±—Ä–∏–¥–Ω—ã–π —Ä–µ–∂–∏–º: In-Memory (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) ‚Üí Redis (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö –∑–∞–ø–∏—Å–µ–π

**–ö–ª–∞—Å—Å—ã**:

#### `SemanticCache`
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫—ç—à–µ–º (In-Memory –∏–ª–∏ Redis)
- –ú–µ—Ç–æ–¥—ã: `get()`, `set()`, `clear()`

**–†–µ–∂–∏–º—ã**:
- **In-Memory** (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) ‚Äî –±—ã—Å—Ç—Ä—ã–π, –Ω–æ —Ç–µ—Ä—è–µ—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ
- **Redis** (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) ‚Äî –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω—ã–π, –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º—ã–π

**–ê–ª–≥–æ—Ä–∏—Ç–º**:
- –°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ (cosine similarity embeddings)
- TTL: `CACHE_TTL` —Å–µ–∫—É–Ω–¥ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 3600 ‚Äî 1 —á–∞—Å)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö –∑–∞–ø–∏—Å–µ–π

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**:
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ In-Memory –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ Redis
- –§–æ–Ω–æ–≤–∞—è –æ—á–∏—Å—Ç–∫–∞ –¥–ª—è In-Memory –∫—ç—à–∞
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫—ç—à–∞ –≤ —Ñ–∞–π–ª –¥–ª—è In-Memory —Ä–µ–∂–∏–º–∞

---

### 7. **Advanced Search** (–ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π –ø–æ–∏—Å–∫)

**–§–∞–π–ª**: `rag_server/advanced_search.py` (200 —Å—Ç—Ä–æ–∫)

**–§—É–Ω–∫—Ü–∏–∏**:
- Pseudo-Relevance Feedback (PRF)
- Query Rewriting —á–µ—Ä–µ–∑ Ollama
- Fallback Search (3 —É—Ä–æ–≤–Ω—è)
- –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤

**–ö–ª—é—á–µ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏**:

#### `pseudo_relevance_feedback()`
- –ü—Ä–∏–º–µ–Ω—è–µ—Ç PRF –¥–ª—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞
- –ò–∑–≤–ª–µ–∫–∞–µ—Ç –∫–ª—é—á–µ–≤—ã–µ —Ç–µ—Ä–º–∏–Ω—ã –∏–∑ —Ç–æ–ø-K —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- –î–æ–±–∞–≤–ª—è–µ—Ç –∏—Ö –∫ –∑–∞–ø—Ä–æ—Å—É –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞

#### `rewrite_query_with_ollama()`
- –ü–µ—Ä–µ—Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞ —á–µ—Ä–µ–∑ Ollama
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –∑–∞–ø—Ä–æ—Å–∞
- –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ (–µ—Å–ª–∏ `USE_OLLAMA_FOR_QUERY_EXPANSION=true`)

#### `get_fallback_search()`
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ 3-—É—Ä–æ–≤–Ω–µ–≤—ã–º fallback –ø–æ–∏—Å–∫–æ–º
- –£—Ä–æ–≤–µ–Ω—å 1: –£–±—Ä–∞—Ç—å space —Ñ–∏–ª—å—Ç—Ä
- –£—Ä–æ–≤–µ–Ω—å 2: PRF (Pseudo-Relevance Feedback)
- –£—Ä–æ–≤–µ–Ω—å 3: –°–Ω–∏–∑–∏—Ç—å –ø–æ—Ä–æ–≥ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏

#### `extract_keywords()`
- –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤ –∏–∑ –∑–∞–ø—Ä–æ—Å–∞
- –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–æ–ø-—Å–ª–æ–≤ (—Ä—É—Å—Å–∫–∏–π + –∞–Ω–≥–ª–∏–π—Å–∫–∏–π)

---

### 8. **Hybrid Search** (Vector + BM25)

**–§–∞–π–ª**: `rag_server/hybrid_search.py` (278 —Å—Ç—Ä–æ–∫)

**–§—É–Ω–∫—Ü–∏–∏**:
- –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –≤–µ–∫—Ç–æ—Ä–Ω–æ–≥–æ –∏ full-text –ø–æ–∏—Å–∫–∞ —á–µ—Ä–µ–∑ Reciprocal Rank Fusion (RRF)
- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è BM25Retriever –∏–∑ LlamaIndex
- –õ–µ–Ω–∏–≤–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è BM25 –∏–Ω–¥–µ–∫—Å–∞

**–ö–ª—é—á–µ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏**:

#### `init_bm25_retriever(collection)`
- –ó–∞–≥—Ä—É–∑–∫–∞ –≤—Å–µ—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –∏–∑ ChromaDB (–¥–æ `BM25_MAX_DOCS`)
- –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ LlamaIndex Document ‚Üí Node —á–µ—Ä–µ–∑ SimpleNodeParser
- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è BM25Retriever —á–µ—Ä–µ–∑ `from_defaults(nodes=nodes, language='ru')`
- –õ–µ–Ω–∏–≤–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è (–æ–¥–∏–Ω —Ä–∞–∑ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏)
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏ –ø—É—Å—Ç—ã—Ö –∫–æ–ª–ª–µ–∫—Ü–∏–π

#### `hybrid_search(query, collection, vector_results, space_filter, limit)`
- –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ BM25 –ø–æ–∏—Å–∫–∞ —á–µ—Ä–µ–∑ BM25Retriever
- –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —á–µ—Ä–µ–∑ RRF (Reciprocal Rank Fusion)
- –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–∞ –ø–æ space (–µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω)
- –í–æ–∑–≤—Ä–∞—Ç –æ–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ–º –ø–æ limit

#### `reciprocal_rank_fusion(vector_results, bm25_results, k=60)`
- –§–æ—Ä–º—É–ª–∞ RRF: `VECTOR_WEIGHT √ó (1 / (k + vector_rank)) + BM25_WEIGHT √ó (1 / (k + bm25_rank))`
- –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Å —É—á–µ—Ç–æ–º —Ä–∞–Ω–≥–∞
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏—Å—Ö–æ–¥–Ω—ã—Ö scores (vector_score, bm25_score, rrf_score)
- –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –∏—Ç–æ–≥–æ–≤–æ–º—É RRF score

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è**:
- `ENABLE_HYBRID_SEARCH=true` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
- `HYBRID_VECTOR_WEIGHT=0.6` (–≤–µ—Å –≤–µ–∫—Ç–æ—Ä–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞)
- `HYBRID_BM25_WEIGHT=0.4` (–≤–µ—Å BM25 –ø–æ–∏—Å–∫–∞)
- `HYBRID_RRF_K=60` (–ø–∞—Ä–∞–º–µ—Ç—Ä RRF, —Å—Ç–∞–Ω–¥–∞—Ä—Ç)
- `BM25_MAX_DOCS=50000` (–ª–∏–º–∏—Ç –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –¥–ª—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏)

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞**:
- ‚úÖ +14-25% —É–ª—É—á—à–µ–Ω–∏–µ —Ç–æ—á–Ω–æ—Å—Ç–∏ (–æ—Å–æ–±–µ–Ω–Ω–æ –¥–ª—è —Ç–æ—á–Ω—ã—Ö —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π)
- ‚úÖ –ö–æ–º–±–∏–Ω–∏—Ä—É–µ—Ç —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π (Vector) –∏ keyword (BM25) –ø–æ–∏—Å–∫
- ‚úÖ Industry standard (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Google, OpenAI, Meta, Microsoft, AWS)
- ‚úÖ –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–µ –≤–µ—Å–∞ —á–µ—Ä–µ–∑ ENV

---

### 9. **Configuration** (—Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è)

**–§–∞–π–ª**: –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (`.env`)

**–§—É–Ω–∫—Ü–∏–∏**:
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è
- –í–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—É—Ç–µ–π –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

**–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è**:

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –û–ø–∏—Å–∞–Ω–∏–µ | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é | –û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞ |
|------------|----------|--------------|-------------|
| `CONFLUENCE_URL` | URL –≤–∞—à–µ–≥–æ Confluence (—Å `/` –≤ –∫–æ–Ω—Ü–µ) | - | ‚úÖ –î–∞ |
| `CONFLUENCE_TOKEN` | API —Ç–æ–∫–µ–Ω Confluence | - | ‚úÖ –î–∞ |
| `CHROMA_PATH` | –ü—É—Ç—å –∫ –±–∞–∑–µ ChromaDB | `./chroma_data` | ‚ùå –ù–µ—Ç |
| `STATE_FILE` | –§–∞–π–ª —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ | `./sync_state.json` | ‚ùå –ù–µ—Ç |
| `USE_OLLAMA` | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Ollama –≤–º–µ—Å—Ç–æ HuggingFace | `false` | ‚ùå –ù–µ—Ç |
| `OLLAMA_URL` | URL Ollama —Å–µ—Ä–≤–µ—Ä–∞ | `http://ollama:11434` | ‚ùå –ù–µ—Ç |
| `EMBED_MODEL` | –ú–æ–¥–µ–ª—å —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤ | `ai-forever/FRIDA` | ‚ùå –ù–µ—Ç |
| `SYNC_INTERVAL` | –ò–Ω—Ç–µ—Ä–≤–∞–ª —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ (—Å–µ–∫—É–Ω–¥—ã) | `3600` | ‚ùå –ù–µ—Ç |
| `BATCH_SIZE` | –†–∞–∑–º–µ—Ä –±–∞—Ç—á–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ | `50` | ‚ùå –ù–µ—Ç |
| `MAX_SPACES` | –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ | `10` | ‚ùå –ù–µ—Ç |
| `CONFLUENCE_SPACES` | –§–∏–ª—å—Ç—Ä –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤ –¥–ª—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏ (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é) | `""` | ‚ùå –ù–µ—Ç |
| `MAX_CHUNK_SIZE` | –†–∞–∑–º–µ—Ä —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ —á–∞–Ω–∫–∞ (—Å–∏–º–≤–æ–ª–æ–≤) | `1000` | ‚ùå –ù–µ—Ç |
| `CHUNK_OVERLAP` | –ü–µ—Ä–µ–∫—Ä—ã—Ç–∏–µ –º–µ–∂–¥—É —á–∞–Ω–∫–∞–º–∏ (—Å–∏–º–≤–æ–ª–æ–≤) | `100` | ‚ùå –ù–µ—Ç |
| `MIN_TEXT_LEN` | –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ —Ç–µ–∫—Å—Ç–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –¥–ª—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏ | `50` | ‚ùå –ù–µ—Ç |
| `USE_REDIS_CACHE` | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Redis –¥–ª—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è | `false` | ‚ùå –ù–µ—Ç |
| `CACHE_TTL` | –í—Ä–µ–º—è –∂–∏–∑–Ω–∏ –∫—ç—à–∞ (—Å–µ–∫—É–Ω–¥—ã) | `3600` | ‚ùå –ù–µ—Ç |
| `USE_STATIC_SYNONYMS` | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–∞–∑–æ–≤—ã–π —Å–ª–æ–≤–∞—Ä—å —Å–∏–Ω–æ–Ω–∏–º–æ–≤ | `true` | ‚ùå –ù–µ—Ç |
| `USE_OLLAMA_FOR_QUERY_EXPANSION` | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Ollama –¥–ª—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ | `false` | ‚ùå –ù–µ—Ç |
| `OLLAMA_MODEL_FOR_EXPANSION` | –ú–æ–¥–µ–ª—å Ollama –¥–ª—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ | `llama3.2` | ‚ùå –ù–µ—Ç |
| `ENABLE_AUTO_FALLBACK` | –í–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π Fallback | `true` | ‚ùå –ù–µ—Ç |
| `ENABLE_PRF_FALLBACK` | –í–∫–ª—é—á–∏—Ç—å PRF –∫–∞–∫ Fallback | `true` | ‚ùå –ù–µ—Ç |
| `MIN_FALLBACK_RESULTS` | –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –¥–ª—è Fallback | `3` | ‚ùå –ù–µ—Ç |
| `LOG_LEVEL` | –£—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è | `INFO` | ‚ùå –ù–µ—Ç |
| `VERIFY_SSL` | –ü—Ä–æ–≤–µ—Ä—è—Ç—å SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã | `true` | ‚ùå –ù–µ—Ç |
| `RE_RANKER_MODEL` | –ú–æ–¥–µ–ª—å –¥–ª—è CrossEncoder reranking | `DiTy/cross-encoder-russian-msmarco` | ‚ùå –ù–µ—Ç |
| `RERANK_THRESHOLD_TECHNICAL` | –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π rerank score –¥–ª—è —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ | `0.01` | ‚ùå –ù–µ—Ç |
| `RERANK_THRESHOLD_GENERAL` | –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π rerank score –¥–ª—è –æ–±—â–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ | `0.005` | ‚ùå –ù–µ—Ç |
| `ENABLE_HYBRID_SEARCH` | –í–∫–ª—é—á–∏—Ç—å Hybrid Search (Vector + BM25) | `true` | ‚ùå –ù–µ—Ç |
| `HYBRID_VECTOR_WEIGHT` | –í–µ—Å –≤–µ–∫—Ç–æ—Ä–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞ –≤ Hybrid Search | `0.6` | ‚ùå –ù–µ—Ç |
| `HYBRID_BM25_WEIGHT` | –í–µ—Å BM25 –ø–æ–∏—Å–∫–∞ –≤ Hybrid Search | `0.4` | ‚ùå –ù–µ—Ç |
| `HYBRID_RRF_K` | –ü–∞—Ä–∞–º–µ—Ç—Ä Reciprocal Rank Fusion | `60` | ‚ùå –ù–µ—Ç |
| `BM25_MAX_DOCS` | –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –¥–ª—è BM25 –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏ | `50000` | ‚ùå –ù–µ—Ç |
| `OPENAI_API_BASE` | URL OpenAI-compatible API (OpenRouter, Ollama, LM Studio) | - | ‚ùå –ù–µ—Ç |
| `OPENAI_API_KEY` | API –∫–ª—é—á –¥–ª—è OpenAI-compatible API | - | ‚ùå –ù–µ—Ç |
| `OPENAI_MODEL` | –ú–æ–¥–µ–ª—å –¥–ª—è OpenAI-compatible API | - | ‚ùå –ù–µ—Ç |

**–í–∞–ª–∏–¥–∞—Ü–∏—è**:
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö (`CONFLUENCE_URL`, `CONFLUENCE_TOKEN`)
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã—Ö –ø—É—Ç–µ–π

---

## üîÑ –ü—Ä–æ—Ü–µ—Å—Å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ

**–£—Å–ª–æ–≤–∏—è –∑–∞–ø—É—Å–∫–∞**:
- –ó–∞–ø—É—Å–∫ `sync.py` –≤ —Ñ–æ–Ω–æ–≤–æ–º –ø–æ—Ç–æ–∫–µ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
- –ü–µ—Ä–≤–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞
- –ü–æ—Å–ª–µ–¥—É—é—â–∏–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –∫–∞–∂–¥—ã–µ `SYNC_INTERVAL` —Å–µ–∫—É–Ω–¥

**–ü—Ä–æ—Ü–µ—Å—Å**:

```
1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è embedding –º–æ–¥–µ–ª–∏
   ‚îú‚îÄ –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1: OpenAI-compatible API (–µ—Å–ª–∏ OPENAI_API_BASE —É–∫–∞–∑–∞–Ω)
   ‚îú‚îÄ –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2: Ollama —á–µ—Ä–µ–∑ LlamaIndex (–µ—Å–ª–∏ USE_OLLAMA=true)
   ‚îú‚îÄ –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3: HuggingFace (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
   ‚îî‚îÄ –°—Ç—Ä–æ–≥–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –±–µ–∑ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ fallback (–ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –Ω–µ—Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Ä–∞–∑–º–µ—Ä–Ω–æ—Å—Ç–∏)

2. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è ChromaDB
   ‚îú‚îÄ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –∫–æ–ª–ª–µ–∫—Ü–∏–∏
   ‚îú‚îÄ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ embedding –º–æ–¥–µ–ª–∏
   ‚îÇ  ‚îî‚îÄ –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –ø—Ä–∏ –Ω–µ—Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
   ‚îî‚îÄ –°–æ–∑–¥–∞–Ω–∏–µ/–∑–∞–≥—Ä—É–∑–∫–∞ –∫–æ–ª–ª–µ–∫—Ü–∏–∏

3. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Confluence API
   ‚îú‚îÄ –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ Confluence
   ‚îú‚îÄ –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ spaces
   ‚îÇ  ‚îú‚îÄ –ï—Å–ª–∏ —É–∫–∞–∑–∞–Ω CONFLUENCE_SPACES ‚Üí —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —É–∫–∞–∑–∞–Ω–Ω—ã–º –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞–º
   ‚îÇ  ‚îî‚îÄ –ï—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω ‚Üí –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ MAX_SPACES (–ø–µ—Ä–≤—ã–µ N –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤)
   ‚îî‚îÄ –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü –¥–ª—è –∫–∞–∂–¥–æ–≥–æ space

4. –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è
   ‚îú‚îÄ –ü—Ä–æ–≤–µ—Ä–∫–∞ last_modified –¥–ª—è –∫–∞–∂–¥–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
   ‚îú‚îÄ –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–æ–ª—å–∫–æ –∏–∑–º–µ–Ω—ë–Ω–Ω—ã—Ö —Å—Ç—Ä–∞–Ω–∏—Ü
   ‚îú‚îÄ –ü–∞—Ä—Å–∏–Ω–≥ HTML –∫–æ–Ω—Ç–µ–Ω—Ç–∞ —á–µ—Ä–µ–∑ BeautifulSoup
   ‚îú‚îÄ Structural Chunking (—Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü, —Å–ø–∏—Å–∫–æ–≤, –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤)
   ‚îÇ  ‚îú‚îÄ –¢–∞–±–ª–∏—Ü—ã –∏ —Å–ø–∏—Å–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –∫–∞–∫ –∞—Ç–æ–º–∞—Ä–Ω—ã–µ –µ–¥–∏–Ω–∏—Ü—ã
   ‚îÇ  ‚îú‚îÄ –¢–µ–∫—Å—Ç–æ–≤—ã–µ –±–ª–æ–∫–∏ —Ä–∞–∑–±–∏–≤–∞—é—Ç—Å—è –ø–æ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è–º —Å overlap
   ‚îÇ  ‚îî‚îÄ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–µ—Ä–∞—Ä—Ö–∏–∏ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ (parent_path)
   ‚îú‚îÄ –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –ø–æ–ª–Ω–æ–≥–æ –ø—É—Ç–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã (page_path –∏–∑ ancestors)
   ‚îú‚îÄ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è embeddings (–±–∞—Ç—á–∞–º–∏ –ø–æ BATCH_SIZE)
   ‚îî‚îÄ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ ChromaDB —Å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏ (type, parent_path, page_path, is_complete_block)

5. –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–æ–º–µ–Ω–Ω—ã—Ö —Ç–µ—Ä–º–∏–Ω–æ–≤
   ‚îú‚îÄ –ê–Ω–∞–ª–∏–∑ –≤—Å–µ—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –≤ ChromaDB
   ‚îú‚îÄ –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ spaces, –∞–±–±—Ä–µ–≤–∏–∞—Ç—É—Ä
   ‚îî‚îÄ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ domain_terms.json

6. –ó–∞–ø—É—Å–∫ MCP —Å–µ—Ä–≤–µ—Ä–∞
   ‚îî‚îÄ –ì–æ—Ç–æ–≤ –∫ –æ–±—Ä–∞–±–æ—Ç–∫–µ –∑–∞–ø—Ä–æ—Å–æ–≤
```

**–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**:
- –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞–∂–¥–æ–≥–æ —ç—Ç–∞–ø–∞
- –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä—ã –¥–ª—è –±–æ–ª—å—à–∏—Ö –±–∞—Ç—á–µ–π
- –°–æ–æ–±—â–µ–Ω–∏—è –æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ –ø—Ä–æ–∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
- –°–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º

**–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏**:
–ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –≤—ã–≤–æ–¥–∏—Ç—Å—è –¥–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:

- **–ü–æ –∫–∞–∂–¥–æ–º—É –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤—É**:
  - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö —Å—Ç—Ä–∞–Ω–∏—Ü –∏ –±–ª–æ–≥–æ–≤
  - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö, –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö, –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã—Ö —Å—Ç—Ä–∞–Ω–∏—Ü
  - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—à–∏–±–æ–∫ —Å –¥–µ—Ç–∞–ª—è–º–∏ (–ø–µ—Ä–≤—ã–µ 5 –æ—à–∏–±–æ–∫)
  - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö chunks
  
- **–û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞**:
  - –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö/–ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã—Ö —Å—Ç—Ä–∞–Ω–∏—Ü
  - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—à–∏–±–æ–∫
  - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–¥–∞–ª–µ–Ω–Ω—ã—Ö —Å—Ç—Ä–∞–Ω–∏—Ü
  - –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

**–ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞**:
```
================================================================================
üìä –ò–¢–û–ì–ò –°–ò–ù–•–†–û–ù–ò–ó–ê–¶–ò–ò
================================================================================
‚è±  –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è: 245.3—Å (4.1 –º–∏–Ω)

üìÅ –°–¢–ê–¢–ò–°–¢–ò–ö–ê –ü–û –ü–†–û–°–¢–†–ê–ù–°–¢–í–ê–ú:
--------------------------------------------------------------------------------
  üìÇ RAUII:
     –°—Ç—Ä–∞–Ω–∏—Ü –Ω–∞–π–¥–µ–Ω–æ: 58 (–±–ª–æ–≥–æ–≤: 3)
     –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ: 58
     –û–±–Ω–æ–≤–ª–µ–Ω–æ: 50 | –ü—Ä–æ–ø—É—â–µ–Ω–æ: 8 | –û—à–∏–±–æ–∫: 0
     Chunks —Å–æ–∑–¥–∞–Ω–æ: 106

  üìÇ MAP:
     –°—Ç—Ä–∞–Ω–∏—Ü –Ω–∞–π–¥–µ–Ω–æ: 45 (–±–ª–æ–≥–æ–≤: 0)
     –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ: 45
     –û–±–Ω–æ–≤–ª–µ–Ω–æ: 20 | –ü—Ä–æ–ø—É—â–µ–Ω–æ: 25 | –û—à–∏–±–æ–∫: 0
     Chunks —Å–æ–∑–¥–∞–Ω–æ: 63

================================================================================
üìà –û–ë–©–ê–Ø –°–¢–ê–¢–ò–°–¢–ò–ö–ê:
   ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–æ: 70
   ‚è≠  –ü—Ä–æ–ø—É—â–µ–Ω–æ: 33
   ‚ùå –û—à–∏–±–æ–∫: 0
   üóë  –£–¥–∞–ª–µ–Ω–æ: 0
   ‚è±  –í—Ä–µ–º—è: 245.3—Å
================================================================================
```

**–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤**:

–°–∏—Å—Ç–µ–º–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –¥–≤–∞ —Ä–µ–∂–∏–º–∞ –≤—ã–±–æ—Ä–∞ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤ –¥–ª—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏:

1. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–∂–∏–º** (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é):
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø–∞—Ä–∞–º–µ—Ç—Ä `MAX_SPACES`
   - –ò–Ω–¥–µ–∫—Å–∏—Ä—É—é—Ç—Å—è –ø–µ—Ä–≤—ã–µ N –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤ –∏–∑ —Å–ø–∏—Å–∫–∞ Confluence

2. **–†—É—á–Ω–æ–π —Ä–µ–∂–∏–º** (—á–µ—Ä–µ–∑ `CONFLUENCE_SPACES`):
   - –£–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞ —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é
   - –ü—Ä–∏–º–µ—Ä: `CONFLUENCE_SPACES=RAUII,MAP,MD,MI`
   - –ò–Ω–¥–µ–∫—Å–∏—Ä—É—é—Ç—Å—è —Ç–æ–ª—å–∫–æ —É–∫–∞–∑–∞–Ω–Ω—ã–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞
   - –ù–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –ø–æ—Ä—è–¥–∫–∞ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤ –≤ Confluence
   - **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –ï—Å–ª–∏ —É–∫–∞–∑–∞–Ω—ã –æ–±–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ (`CONFLUENCE_SPACES` –∏ `MAX_SPACES`), –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `CONFLUENCE_SPACES`, –∞ `MAX_SPACES` –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è
   - –í –ª–æ–≥–∞—Ö –≤—ã–≤–æ–¥–∏—Ç—Å—è –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ, –µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω—ã –æ–±–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞
   - –í –ª–æ–≥–∞—Ö –≤—ã–≤–æ–¥–∏—Ç—Å—è –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ, –µ—Å–ª–∏ –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ —É–∫–∞–∑–∞–Ω–Ω—ã–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –≤ Confluence

---

## üîç –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π –ø–æ–∏—Å–∫ (Advanced Search Pipeline)

### –ê–ª–≥–æ—Ä–∏—Ç–º –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–∞

**–ü–æ–ª–Ω—ã–π pipeline**:

```
1. SEMANTIC CACHING
   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
   ‚îÇ  –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫—ç—à–∞           ‚îÇ
   ‚îÇ  (cosine similarity)    ‚îÇ
   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                ‚îÇ
                ‚îú‚îÄ Cache HIT ‚Üí –≤–æ–∑–≤—Ä–∞—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ (0.8 —Å–µ–∫)
                ‚îî‚îÄ Cache MISS ‚Üí –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ
                                ‚îÇ
                                ‚Üì
2. QUERY INTENT CLASSIFICATION
   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
   ‚îÇ  –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –Ω–∞–º–µ—Ä–µ–Ω–∏—è ‚îÇ
   ‚îÇ  - navigational          ‚îÇ
   ‚îÇ  - howto                 ‚îÇ
   ‚îÇ  - factual               ‚îÇ
   ‚îÇ  - exploratory           ‚îÇ
   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                ‚îÇ
                ‚Üì
3. QUERY EXPANSION (4 –∏—Å—Ç–æ—á–Ω–∏–∫–∞)
   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
   ‚îÇ  1. –ë–∞–∑–æ–≤—ã–π —Å–ª–æ–≤–∞—Ä—å      ‚îÇ
   ‚îÇ  2. –î–æ–º–µ–Ω–Ω—ã–µ —Ç–µ—Ä–º–∏–Ω—ã     ‚îÇ
   ‚îÇ  3. –í—ã—É—á–µ–Ω–Ω—ã–µ —Å–∏–Ω–æ–Ω–∏–º—ã   ‚îÇ
   ‚îÇ  4. Ollama (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) ‚îÇ
   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                ‚îÇ
                ‚Üì
   Query: "—Å—Ç–µ–∫ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π RAUII"
   ‚Üí ["—Å—Ç–µ–∫ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π RAUII",
      "—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫ RAUII",
      "–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ RAUII",
      ...]
                ‚îÇ
                ‚Üì
4. ADAPTIVE CANDIDATE LIMIT
   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
   ‚îÇ  query_words <= 2: 25    ‚îÇ
   ‚îÇ  query_words <= 4: 20    ‚îÇ
   ‚îÇ  query_words > 4: 15     ‚îÇ
   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                ‚îÇ
                ‚Üì
5. MULTI-QUERY SEARCH
   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
   ‚îÇ  ChromaDB Query          ‚îÇ
   ‚îÇ  + Metadata Filter       ‚îÇ
   ‚îÇ  (space="RAUII")         ‚îÇ
   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                ‚îÇ
                ‚Üì
   35 —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –Ω–∞–π–¥–µ–Ω–æ
                ‚îÇ
                ‚Üì
6. DEDUPLICATION
   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
   ‚îÇ  –£–¥–∞–ª–µ–Ω–∏–µ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤     ‚îÇ
   ‚îÇ  (–ø–æ ID –¥–æ–∫—É–º–µ–Ω—Ç–∞)        ‚îÇ
   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                ‚îÇ
                ‚Üì
   28 —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö
                ‚îÇ
                ‚Üì
6. HYBRID SEARCH (Vector + BM25)
   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
   ‚îÇ  Reciprocal Rank Fusion   ‚îÇ
   ‚îÇ  (RRF) –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ        ‚îÇ
   ‚îÇ  Vector + BM25 —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤‚îÇ
   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                ‚îÇ
                ‚Üì
   32 –æ–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
                ‚îÇ
                ‚Üì
7. CROSSENCODER RERANKING
   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
   ‚îÇ  Russian MS-MARCO        ‚îÇ
   ‚îÇ  (DiTy/cross-encoder-    ‚îÇ
   ‚îÇ   russian-msmarco)       ‚îÇ
   ‚îÇ  - 92% –¥–ª—è —Ä—É—Å—Å–∫–æ–≥–æ     ‚îÇ
   ‚îÇ  - –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ –ø–æ—Ä–æ–≥–∏     ‚îÇ
   ‚îÇ  - –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑   ‚îÇ
   ‚îÇ    RE_RANKER_MODEL       ‚îÇ
   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                ‚îÇ
                ‚Üì
   Scores: [0.295, 0.252, 0.151, ...]
   –î–∏–∞–ø–∞–∑–æ–Ω: 0.001 - 0.295
   (—Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –ø–æ—Ä–æ–≥—É: 0.01/0.005)
                ‚îÇ
                ‚Üì
8. CONTEXT EXPANSION
   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
   ‚îÇ  ¬±1 —á–∞–Ω–∫ —Å —Ç–æ–π –∂–µ        ‚îÇ
   ‚îÇ  —Å—Ç—Ä–∞–Ω–∏—Ü—ã                ‚îÇ
   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                ‚îÇ
                ‚Üì
9. SCORE BOOSTING
   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
   ‚îÇ  + Hierarchy Boost       ‚îÇ
   ‚îÇ  + Breadcrumb Match      ‚îÇ
   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                ‚îÇ
                ‚Üì
   Final Score: 8.4 üî•
                ‚îÇ
                ‚Üì
10. CONTENT TYPE DETECTION
   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
   ‚îÇ  - table: –¥–æ 2400 —Å–∏–º–≤–æ–ª–æ–≤‚îÇ
   ‚îÇ  - list: –¥–æ 2400 —Å–∏–º–≤–æ–ª–æ–≤‚îÇ
   ‚îÇ  - code: –¥–æ 1200 —Å–∏–º–≤–æ–ª–æ–≤‚îÇ
   ‚îÇ  - text: –¥–æ 400 —Å–∏–º–≤–æ–ª–æ–≤ ‚îÇ
   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                ‚îÇ
                ‚Üì
11. DIVERSITY FILTER
   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
   ‚îÇ  –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —á–∞–Ω–∫–æ–≤      ‚îÇ
   ‚îÇ  —Å –æ–¥–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã        ‚îÇ
   ‚îÇ  (–ø–æ intent)             ‚îÇ
   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                ‚îÇ
                ‚Üì
12. FALLBACK SEARCH (–µ—Å–ª–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ < 3)
   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
   ‚îÇ  Level 1: –£–±—Ä–∞—Ç—å space   ‚îÇ
   ‚îÇ  Level 2: PRF            ‚îÇ
   ‚îÇ  Level 3: –°–Ω–∏–∑–∏—Ç—å –ø–æ—Ä–æ–≥  ‚îÇ
   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                ‚îÇ
                ‚Üì
13. SEMANTIC CACHE SAVE
   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
   ‚îÇ  –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞   ‚îÇ
   ‚îÇ  –≤ –∫—ç—à                   ‚îÇ
   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                ‚îÇ
                ‚Üì
14. QUERY MINING
   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
   ‚îÇ  –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞     ‚îÇ
   ‚îÇ  –¥–ª—è –æ–±—É—á–µ–Ω–∏—è            ‚îÇ
   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                ‚îÇ
                ‚Üì
   –†–ï–ó–£–õ–¨–¢–ê–¢
```

### –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `seen_ids` set –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —É–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
- –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –º–µ–∂–¥—É multi-query search
- –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º —Å –±–æ–ª–µ–µ –≤—ã—Å–æ–∫–∏–º rerank score

---

## üê≥ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è

### Single-stage build

**Dockerfile**: `Dockerfile.standalone`

```dockerfile
FROM python:3.11-slim
- –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (curl)
- –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Python –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –∏–∑ requirements.txt
- –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- Health check (–ø—Ä–æ–≤–µ—Ä–∫–∞ ChromaDB –∏ MCP —Å–µ—Ä–≤–µ—Ä–∞)
- –ó–∞–ø—É—Å–∫ sync.py –∏ server.py –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ–±—Ä–∞–∑ (~2-3 GB)

### Docker Compose

**–§–∞–π–ª**: `docker-compose.yml`

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è**:
- –û–±—Ä–∞–∑: `confluence-rag:latest` (–ª–æ–∫–∞–ª—å–Ω—ã–π)
- –ü–æ—Ä—Ç: `8012:8012`
- Volumes:
  - `CHROMA_PATH` ‚Üí `/app/chroma_data` (–ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ)
  - `./data` ‚Üí `/app/data` (–∫—ç—à, —Å–∏–Ω–æ–Ω–∏–º—ã, –ª–æ–≥–∏)
- –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–≤–µ–¥–µ–Ω–∏—è
- Health check: –ø—Ä–æ–≤–µ—Ä–∫–∞ ChromaDB –∏ MCP —Å–µ—Ä–≤–µ—Ä–∞

---

## üîå –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–æ–≤

### Open WebUI

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è** (Settings ‚Üí Tools ‚Üí Add MCP Server):
- **–¢–∏–ø**: MCP Streamable HTTP
- **URL**: `http://confluence-rag:8012/mcp` (–≤–Ω—É—Ç—Ä–∏ Docker —Å–µ—Ç–∏) –∏–ª–∏ `http://host.docker.internal:8012/mcp` (–∏–∑ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞)
- **–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è**: –ë–µ–∑ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**:
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ streamable-http –ø—Ä–æ—Ç–æ–∫–æ–ª–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
- JSON-RPC 2.0 —á–µ—Ä–µ–∑ HTTP POST
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤

### Claude Desktop

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è** (`claude_desktop_config.json`):
```json
{
  "mcpServers": {
    "confluence-rag": {
      "url": "http://localhost:8012/mcp"
    }
  }
}
```

### Cursor IDE

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è** (`.cursor/mcp.json`):
```json
{
  "mcpServers": {
    "confluence-rag": {
      "url": "http://localhost:8012/mcp"
    }
  }
}
```

---

## üöÄ –ó–∞–ø—É—Å–∫

### Docker (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

#### –°–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–∞
```bash
docker build -f Dockerfile.standalone -t confluence-rag:latest .
```

#### –ó–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
```bash
docker run --rm -d \
  -p 8012:8012 \
  -e CONFLUENCE_URL="https://your-confluence.atlassian.net/" \
  -e CONFLUENCE_TOKEN="<–≤–∞—à_—Ç–æ–∫–µ–Ω>" \
  -v $(pwd)/chroma_data:/app/chroma_data \
  -v $(pwd)/data:/app/data \
  --name confluence-rag \
  confluence-rag:latest
```

#### –° Ollama –¥–ª—è —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤
```bash
docker run --rm -d \
  -p 8012:8012 \
  -e CONFLUENCE_URL="https://your-confluence.atlassian.net/" \
  -e CONFLUENCE_TOKEN="<–≤–∞—à_—Ç–æ–∫–µ–Ω>" \
  -e USE_OLLAMA=true \
  -e OLLAMA_URL="http://ollama:11434" \
  -v $(pwd)/chroma_data:/app/chroma_data \
  -v $(pwd)/data:/app/data \
  --network your-network \
  --name confluence-rag \
  confluence-rag:latest
```

### Docker Compose

**–§–∞–π–ª**: `docker-compose.yml`

```yaml
services:
  confluence-rag:
    build:
      context: .
      dockerfile: Dockerfile.standalone
    container_name: confluence-rag
    ports:
      - "8012:8012"
    environment:
      - CONFLUENCE_URL=${CONFLUENCE_URL}
      - CONFLUENCE_TOKEN=${CONFLUENCE_TOKEN}
      - CHROMA_PATH=/app/chroma_data
      - SYNC_INTERVAL=${SYNC_INTERVAL:-3600}
      - USE_OLLAMA=${USE_OLLAMA:-false}
      - EMBED_MODEL=${EMBED_MODEL:-ai-forever/FRIDA}
    volumes:
      - ./chroma_data:/app/chroma_data
      - ./data:/app/data
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "python", "-c", "import chromadb; c=chromadb.PersistentClient(path='./chroma_data'); coll=c.get_collection('confluence'); exit(0 if coll.count()>0 else 1)"]
      interval: 30s
      timeout: 10s
      start_period: 180s
      retries: 3
```

**–ó–∞–ø—É—Å–∫**:
```bash
docker compose up -d
```

### –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞

#### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
```bash
pip install -r requirements.txt
```

#### –ó–∞–ø—É—Å–∫ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ (–≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ)
```bash
python rag_server/sync_confluence_optimized_final.py
```

#### –ó–∞–ø—É—Å–∫ MCP —Å–µ—Ä–≤–µ—Ä–∞
```bash
python rag_server/mcp_rag_secure.py
```

---

## üìä –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

**–£—Ä–æ–≤–Ω–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è**:
- `DEBUG` ‚Äî –¥–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è (–∑–∞–ø—Ä–æ—Å—ã, –æ—Ç–≤–µ—Ç—ã, —Ç–∞–π–º–∏–Ω–≥–∏)
- `INFO` ‚Äî –æ—Å–Ω–æ–≤–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ (—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è, –ø–æ–∏—Å–∫, –∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞)
- `WARNING` ‚Äî –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è (fallback –Ω–∞ –ª–æ–∫–∞–ª—å–Ω—É—é –º–æ–¥–µ–ª—å, –Ω–µ—Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å –º–æ–¥–µ–ª–µ–π)
- `ERROR` ‚Äî –æ—à–∏–±–∫–∏ —Å –ø–æ–ª–Ω—ã–º stack trace

**–ö–ª—é—á–µ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è**:
- `–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è RAG –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ MCP —Å–µ—Ä–≤–µ—Ä–∞...` ‚Äî –Ω–∞—á–∞–ª–æ –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥–µ–ª–∏
- `RAG —Å–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞. –î–æ–∫—É–º–µ–Ω—Ç–æ–≤: N` ‚Äî —É—Å–ø–µ—à–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
- `‚úÖ Cache HIT: '...'` ‚Äî –ø–æ–ø–∞–¥–∞–Ω–∏–µ –≤ –∫—ç—à
- `Cache MISS: '...', –≤—ã–ø–æ–ª–Ω—è—é –ø–æ–∏—Å–∫...` ‚Äî –ø—Ä–æ–º–∞—Ö –∫—ç—à–∞
- `Query intent: exploratory (diversity=2, expand_context=True)` ‚Äî –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –Ω–∞–º–µ—Ä–µ–Ω–∏—è
- `Query expansion: ... ‚Üí [...]` ‚Äî —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞
- `–ù–∞–π–¥–µ–Ω–æ N —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤, –ø–æ—Å–ª–µ deduplication: M` ‚Äî —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞
- `üîÑ Fallback #1: –£–±–∏—Ä–∞—é space —Ñ–∏–ª—å—Ç—Ä...` ‚Äî –∞–∫—Ç–∏–≤–∞—Ü–∏—è fallback
- `‚úÖ –ò–∑–≤–ª–µ—á–µ–Ω–æ N –¥–æ–º–µ–Ω–Ω—ã—Ö —Ç–µ—Ä–º–∏–Ω–æ–≤` ‚Äî –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ç–µ—Ä–º–∏–Ω–æ–≤

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

#### Health check
```bash
curl http://localhost:8012/health
```

#### –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
```bash
docker logs confluence-rag --follow
```

#### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
```bash
docker exec confluence-rag python -c "from mcp_rag_secure import collection; print(f'Documents: {collection.count()}')"
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π

### 1. MCP Initialize (handshake)
```bash
curl -X POST http://localhost:8012/mcp \
  -H "Content-Type: application/json" \
  -H "Accept: application/json, text/event-stream" \
  -d '{
    "jsonrpc":"2.0",
    "id":"init-1",
    "method":"initialize",
    "params":{
      "protocolVersion":"2025-06-18",
      "capabilities":{},
      "clientInfo":{"name":"test","version":"1.0"}
    }
  }'
```

### 2. MCP tools/list
```bash
curl -X POST http://localhost:8012/mcp \
  -H "Content-Type: application/json" \
  -H "Accept: application/json, text/event-stream" \
  -d '{
    "jsonrpc":"2.0",
    "id":"tools-1",
    "method":"tools/list",
    "params":{}
  }'
```

### 3. MCP tools/call (confluence_semantic_search)
```bash
curl -X POST http://localhost:8012/mcp \
  -H "Content-Type: application/json" \
  -H "Accept: application/json, text/event-stream" \
  -d '{
    "jsonrpc":"2.0",
    "id":"call-1",
    "method":"tools/call",
    "params":{
      "name":"confluence_semantic_search",
      "arguments":{
        "query":"–ö–∞–∫–∏–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ –ø—Ä–æ–µ–∫—Ç–µ RAUII?",
        "limit":5,
        "space":"RAUII"
      }
    }
  }'
```

**–û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç** (SSE):
```
data: {"jsonrpc":"2.0","id":"call-1","result":{"content":[{"type":"text","text":"üìç –ù–ò–ò –†–ê–£ –ò–ò ‚Üí –û–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è\n‚Üí –°—Ç–µ–∫ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π\nüî• 8.40 (base:7.2, +hier:0.8, +path:0.4)\nüìö 3 chunks (—Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç)\nüí¨ –†–∞–±–æ—Ç–∞ —Å –ò–ò –º–æ–¥–µ–ª—è–º–∏: Ollama..."}]}}
```

---

## üîç –ö–ª—é—á–µ–≤—ã–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ä–µ—à–µ–Ω–∏—è

### 1. **–ü–æ—á–µ–º—É 12+ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π –ø–æ–∏—Å–∫–∞?**

**–ü—Ä–æ–±–ª–µ–º–∞**: –ë–∞–∑–æ–≤—ã–π –≤–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫ –º–æ–∂–µ—Ç –ø—Ä–æ–ø—É—Å–∫–∞—Ç—å —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã, –Ω–µ —É—á–∏—Ç—ã–≤–∞—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç, –∏–µ—Ä–∞—Ä—Ö–∏—é –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤.

**–†–µ—à–µ–Ω–∏–µ**: –ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–π pipeline –∏–∑ 12+ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π:
- Semantic Caching ‚Äî —É—Å–∫–æ—Ä–µ–Ω–∏–µ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- Query Intent Classification ‚Äî –∞–¥–∞–ø—Ç–∞—Ü–∏—è —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
- Query Expansion ‚Äî –ø–æ–∫—Ä—ã—Ç–∏–µ —Å–∏–Ω–æ–Ω–∏–º–æ–≤ (4 –∏—Å—Ç–æ—á–Ω–∏–∫–∞)
- Multi-Query Search ‚Äî –ø–æ–∏—Å–∫ –ø–æ –Ω–µ—Å–∫–æ–ª—å–∫–∏–º –≤–∞—Ä–∏–∞–Ω—Ç–∞–º
- Metadata Pre-filtering ‚Äî —É—Å–∫–æ—Ä–µ–Ω–∏–µ –ø–æ–∏—Å–∫–∞
- Hybrid Search (Vector + BM25) ‚Äî –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ —á–µ—Ä–µ–∑ RRF
- Deduplication ‚Äî —É–¥–∞–ª–µ–Ω–∏–µ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
- CrossEncoder Reranking ‚Äî —Ç–æ—á–Ω–æ—Å—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ (Russian MS-MARCO)
- Context Expansion ‚Äî –ø–æ–ª–Ω–æ—Ç–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
- Hierarchy Boost ‚Äî –≤–∞–∂–Ω–æ—Å—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü
- Breadcrumb Matching ‚Äî —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å –ø—É—Ç–∏
- Fallback Search ‚Äî –ø–æ–∫—Ä—ã—Ç–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ (3 —É—Ä–æ–≤–Ω—è)
- Content Type Detection ‚Äî —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
- Diversity Filter ‚Äî –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —á–∞–Ω–∫–æ–≤ —Å –æ–¥–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞**:
- ‚úÖ –í—ã—Å–æ–∫–∞—è —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ (94% —Ç–æ—á–Ω–æ—Å—Ç—å —Ç–æ–ø-1)
- ‚úÖ –ü–æ–∫—Ä—ã—Ç–∏–µ 98% –∑–∞–ø—Ä–æ—Å–æ–≤
- ‚úÖ –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (3-8 —Å–µ–∫ –Ω–∞ –∑–∞–ø—Ä–æ—Å)

### 2. **–ü–æ—á–µ–º—É eager loading –º–æ–¥–µ–ª–∏?**

**–ü—Ä–æ–±–ª–µ–º–∞**: –ú–æ–¥–µ–ª—å –∑–∞–≥—Ä—É–∂–∞–ª–∞—Å—å –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ, —á—Ç–æ –ø—Ä–∏–≤–æ–¥–∏–ª–æ –∫ –∑–∞–¥–µ—Ä–∂–∫–∞–º 30-40 —Å–µ–∫—É–Ω–¥.

**–†–µ—à–µ–Ω–∏–µ**: Eager loading –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ –º–æ–¥—É–ª—è (–Ω–∞ —É—Ä–æ–≤–Ω–µ –º–æ–¥—É–ª—è):
- –ú–æ–¥–µ–ª—å –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
- –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ: `collection`, `storage_context`, `index`
- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–æ —Å–æ–∑–¥–∞–Ω–∏—è MCP —Å–µ—Ä–≤–µ—Ä–∞

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞**:
- ‚úÖ –ú–æ–¥–µ–ª—å –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ —Å—Ç–∞—Ä—Ç–∞
- ‚úÖ –ù–µ—Ç –∑–∞–¥–µ—Ä–∂–µ–∫ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—Ä–æ—Å–µ
- ‚úÖ –ü—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ–µ –≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞

### 3. **–ü–æ—á–µ–º—É self-learning —Å–∏—Å—Ç–µ–º–∞ —Å–∏–Ω–æ–Ω–∏–º–æ–≤?**

**–ü—Ä–æ–±–ª–µ–º–∞**: –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–ª–æ–≤–∞—Ä—å —Å–∏–Ω–æ–Ω–∏–º–æ–≤ –Ω–µ –ø–æ–∫—Ä—ã–≤–∞–µ—Ç —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ —Ç–µ—Ä–º–∏–Ω—ã –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏.

**–†–µ—à–µ–Ω–∏–µ**: –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ —Å–∏–Ω–æ–Ω–∏–º–æ–≤:
1. –ë–∞–∑–æ–≤—ã–π —Å–ª–æ–≤–∞—Ä—å (50 –æ–±—â–∏—Ö IT-—Ç–µ—Ä–º–∏–Ω–æ–≤)
2. –î–æ–º–µ–Ω–Ω—ã–µ —Ç–µ—Ä–º–∏–Ω—ã (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–∑ Confluence)
3. –í—ã—É—á–µ–Ω–Ω—ã–µ —Å–∏–Ω–æ–Ω–∏–º—ã (Query Mining ‚Äî –≥—Ä–∞—Ñ —Å–æ–≤–º–µ—Å—Ç–Ω–æ–π –≤—Å—Ç—Ä–µ—á–∞–µ–º–æ—Å—Ç–∏)
4. Ollama (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞**:
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∞–¥–∞–ø—Ç–∞—Ü–∏—è –ø–æ–¥ —Å–ø–µ—Ü–∏—Ñ–∏–∫—É –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏
- ‚úÖ –£–ª—É—á—à–µ–Ω–∏–µ –∫–∞—á–µ—Å—Ç–≤–∞ –ø–æ–∏—Å–∫–∞ —Å–æ –≤—Ä–µ–º–µ–Ω–µ–º
- ‚úÖ –ù–µ —Ç—Ä–µ–±—É–µ—Ç —Ä—É—á–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–ª–æ–≤–∞—Ä—è

### 4. **–ü–æ—á–µ–º—É –≥–∏–±—Ä–∏–¥–Ω—ã–π –∫—ç—à (In-Memory ‚Üí Redis)?**

**–ü—Ä–æ–±–ª–µ–º–∞**: In-Memory –∫—ç—à —Ç–µ—Ä—è–µ—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ, Redis —Ç—Ä–µ–±—É–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã.

**–†–µ—à–µ–Ω–∏–µ**: –ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–¥—Ö–æ–¥:
- In-Memory –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (–±—ã—Å—Ç—Ä–æ, –ø—Ä–æ—Å—Ç–æ)
- Redis –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ (–ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω—ã–π, –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º—ã–π)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ Redis

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞**:
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç "–∏–∑ –∫–æ—Ä–æ–±–∫–∏" –±–µ–∑ –≤–Ω–µ—à–Ω–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- ‚úÖ –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å —á–µ—Ä–µ–∑ Redis –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
- ‚úÖ –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å: –≤—Å–µ–≥–¥–∞ –µ—Å—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç

### 5. **–ü–æ—á–µ–º—É 3-—É—Ä–æ–≤–Ω–µ–≤—ã–π Fallback Search?**

**–ü—Ä–æ–±–ª–µ–º–∞**: –ù–µ–∫–æ—Ç–æ—Ä—ã–µ –∑–∞–ø—Ä–æ—Å—ã –º–æ–≥—É—Ç –Ω–µ –Ω–∞—Ö–æ–¥–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏–∑-–∑–∞ —Å—Ç—Ä–æ–≥–∏—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤ –∏–ª–∏ —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω–æ—Å—Ç–∏.

**–†–µ—à–µ–Ω–∏–µ**: –ü—Ä–æ–≥—Ä–µ—Å—Å–∏–≤–Ω–æ–µ –æ—Å–ª–∞–±–ª–µ–Ω–∏–µ –∫—Ä–∏—Ç–µ—Ä–∏–µ–≤:
1. –£—Ä–æ–≤–µ–Ω—å 1: –£–±—Ä–∞—Ç—å space —Ñ–∏–ª—å—Ç—Ä
2. –£—Ä–æ–≤–µ–Ω—å 2: PRF (Pseudo-Relevance Feedback)
3. –£—Ä–æ–≤–µ–Ω—å 3: –°–Ω–∏–∑–∏—Ç—å –ø–æ—Ä–æ–≥ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞**:
- ‚úÖ –ü–æ–∫—Ä—ã—Ç–∏–µ 98% –∑–∞–ø—Ä–æ—Å–æ–≤
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∞–¥–∞–ø—Ç–∞—Ü–∏—è –∫ —Å–ª–æ–∂–Ω—ã–º –∑–∞–ø—Ä–æ—Å–∞–º
- ‚úÖ –ü–æ–Ω—è—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–∏ fallback

### 6. **–ü–æ—á–µ–º—É Content Type Detection?**

**–ü—Ä–æ–±–ª–µ–º–∞**: –¢–∞–±–ª–∏—Ü—ã –∏ —Å–ø–∏—Å–∫–∏ –æ–±—Ä–µ–∑–∞–ª–∏—Å—å –ø—Ä–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ snippet, —Ç–µ—Ä—è–ª–∞—Å—å –≤–∞–∂–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è.

**–†–µ—à–µ–Ω–∏–µ**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞:
- –¢–∞–±–ª–∏—Ü—ã/—Å–ø–∏—Å–∫–∏: –¥–æ 2400 —Å–∏–º–≤–æ–ª–æ–≤ (–ø–æ–ª–Ω–æ—Å—Ç—å—é)
- –ö–æ–¥: –¥–æ 1200 —Å–∏–º–≤–æ–ª–æ–≤
- –¢–µ–∫—Å—Ç: –¥–æ 400 —Å–∏–º–≤–æ–ª–æ–≤

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞**:
- ‚úÖ –ü–æ–ª–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –¥–ª—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
- ‚úÖ –£–ª—É—á—à–µ–Ω–∏–µ —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

### 7. **–ü–æ—á–µ–º—É Query Intent Classification?**

**–ü—Ä–æ–±–ª–µ–º–∞**: –†–∞–∑–Ω—ã–µ —Ç–∏–ø—ã –∑–∞–ø—Ä–æ—Å–æ–≤ —Ç—Ä–µ–±—É—é—Ç —Ä–∞–∑–Ω—ã—Ö —Å—Ç—Ä–∞—Ç–µ–≥–∏–π –ø–æ–∏—Å–∫–∞.

**–†–µ—à–µ–Ω–∏–µ**: –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –Ω–∞–º–µ—Ä–µ–Ω–∏–π –∏ –∞–¥–∞–ø—Ç–∞—Ü–∏—è —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏:
- Navigational: `diversity=1`, `boost_hierarchy=true`
- How-to: `diversity=3`, `expand_context=true`
- Factual: `diversity=3`, `expand_context=true`
- Exploratory: —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞**:
- ‚úÖ –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞ –∑–∞–ø—Ä–æ—Å–∞
- ‚úÖ –£–ª—É—á—à–µ–Ω–∏–µ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- ‚úÖ –ê–¥–∞–ø—Ç–∞—Ü–∏—è –ø–æ–¥ –Ω–∞–º–µ—Ä–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### 8. **–ü–æ—á–µ–º—É Hybrid Search (Vector + BM25)?**

**–ü—Ä–æ–±–ª–µ–º–∞**: –í–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫ –æ—Ç–ª–∏—á–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–æ–∏—Å–∫–∞, –Ω–æ –º–æ–∂–µ—Ç –ø—Ä–æ–ø—É—Å–∫–∞—Ç—å —Ç–æ—á–Ω—ã–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤. BM25 –æ—Ç–ª–∏—á–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è keyword –ø–æ–∏—Å–∫–∞, –Ω–æ –Ω–µ –ø–æ–Ω–∏–º–∞–µ—Ç —Å–µ–º–∞–Ω—Ç–∏–∫—É.

**–†–µ—à–µ–Ω–∏–µ**: –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Reciprocal Rank Fusion (RRF):
- –í–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫ (ChromaDB) ‚Äî —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫ –ø–æ —Å–º—ã—Å–ª—É
- BM25 –ø–æ–∏—Å–∫ (LlamaIndex) ‚Äî –ø–æ–∏—Å–∫ –ø–æ —Ç–æ—á–Ω—ã–º —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è–º –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤
- RRF ‚Äî –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Å —É—á–µ—Ç–æ–º —Ä–∞–Ω–≥–∞

**–§–æ—Ä–º—É–ª–∞ RRF:**
```
RRF Score = VECTOR_WEIGHT √ó (1 / (k + vector_rank)) + BM25_WEIGHT √ó (1 / (k + bm25_rank))
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞**:
- ‚úÖ +14-25% —É–ª—É—á—à–µ–Ω–∏–µ —Ç–æ—á–Ω–æ—Å—Ç–∏ (–æ—Å–æ–±–µ–Ω–Ω–æ –¥–ª—è —Ç–æ—á–Ω—ã—Ö —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π)
- ‚úÖ Industry standard (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Google, OpenAI, Meta, Microsoft, AWS)
- ‚úÖ –ö–æ–º–±–∏–Ω–∏—Ä—É–µ—Ç –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –æ–±–æ–∏—Ö –ø–æ–¥—Ö–æ–¥–æ–≤
- ‚úÖ –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–µ –≤–µ—Å–∞ —á–µ—Ä–µ–∑ ENV

### 9. **–ü–æ—á–µ–º—É Russian MS-MARCO –¥–ª—è Re-Ranking?**

**–ü—Ä–æ–±–ª–µ–º–∞**: –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è –º–æ–¥–µ–ª—å `ms-marco-MiniLM-L-6-v2` –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ –¥–ª—è –∞–Ω–≥–ª–∏–π—Å–∫–æ–≥–æ —è–∑—ã–∫–∞ –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç 85% —Ç–æ—á–Ω–æ—Å—Ç–∏ –¥–ª—è —Ä—É—Å—Å–∫–æ–≥–æ.

**–†–µ—à–µ–Ω–∏–µ**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –º–æ–¥–µ–ª–∏ `DiTy/cross-encoder-russian-msmarco`:
- –û–±—É—á–µ–Ω–∞ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ
- 92% —Ç–æ—á–Ω–æ—Å—Ç–∏ –¥–ª—è —Ä—É—Å—Å–∫–æ–≥–æ (vs 85% —É —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–π)
- –¢–∞–∫–æ–π –∂–µ —Ä–∞–∑–º–µ—Ä (250 MB)
- –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `RE_RANKER_MODEL`

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞**:
- ‚úÖ +2-3% —É–ª—É—á—à–µ–Ω–∏–µ –¥–ª—è —Ä—É—Å—Å–∫–æ–≥–æ —è–∑—ã–∫–∞
- ‚úÖ –ì–∏–±–∫–æ—Å—Ç—å –≤—ã–±–æ—Ä–∞ –º–æ–¥–µ–ª–∏ —á–µ—Ä–µ–∑ ENV
- ‚úÖ –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ –ø–æ—Ä–æ–≥–∏ –¥–ª—è —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö –∏ –æ–±—â–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- ‚úÖ –û–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ –ø–æ—Ä–æ–≥–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∞–Ω–∞–ª–∏–∑–∞: `0.01`/`0.005` (–¥–∏–∞–ø–∞–∑–æ–Ω scores: 0.001 - 0.295)

### 10. **–ü–æ—á–µ–º—É Structural Chunking?**

**–ü—Ä–æ–±–ª–µ–º–∞**: –ü—Ä–æ—Å—Ç–æ–µ —Ä–∞–∑–±–∏–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –ø–æ —Å–∏–º–≤–æ–ª–∞–º —Ä–∞–∑—Ä—ã–≤–∞–µ—Ç –ª–æ–≥–∏—á–µ—Å–∫–∏–µ –±–ª–æ–∫–∏ (—Ç–∞–±–ª–∏—Ü—ã, —Å–ø–∏—Å–∫–∏), —á—Ç–æ —É—Ö—É–¥—à–∞–µ—Ç –∫–∞—á–µ—Å—Ç–≤–æ –ø–æ–∏—Å–∫–∞.

**–†–µ—à–µ–Ω–∏–µ**: –°—Ç—Ä—É–∫—Ç—É—Ä–Ω–∞—è –Ω–∞—Ä–µ–∑–∫–∞ —Å —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ–º –ª–æ–≥–∏—á–µ—Å–∫–∏—Ö –±–ª–æ–∫–æ–≤:
- –¢–∞–±–ª–∏—Ü—ã –∏ —Å–ø–∏—Å–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –∫–∞–∫ –∞—Ç–æ–º–∞—Ä–Ω—ã–µ –µ–¥–∏–Ω–∏—Ü—ã (–Ω–µ —Ä–∞–∑–±–∏–≤–∞—é—Ç—Å—è)
- –¢–µ–∫—Å—Ç–æ–≤—ã–µ –±–ª–æ–∫–∏ —Ä–∞–∑–±–∏–≤–∞—é—Ç—Å—è –ø–æ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è–º —Å overlap
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–µ—Ä–∞—Ä—Ö–∏–∏ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ (parent_path)
- –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –ø–æ–ª–Ω–æ–≥–æ –ø—É—Ç–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã (page_path)

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞**:
- ‚úÖ –¢–∞–±–ª–∏—Ü—ã –∏ —Å–ø–∏—Å–∫–∏ –∏–Ω–¥–µ–∫—Å–∏—Ä—É—é—Ç—Å—è —Ü–µ–ª–∏–∫–æ–º
- ‚úÖ –£–ª—É—á—à–µ–Ω–∏–µ –∫–∞—á–µ—Å—Ç–≤–∞ RAG –Ω–∞ 15-25%
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
- ‚úÖ Industry standard (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ Langchain, LlamaIndex)

### 11. **–ü–æ—á–µ–º—É page_path –≤ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö?**

**–ü—Ä–æ–±–ª–µ–º–∞**: –¢–æ–ª—å–∫–æ `parent_title` (–±–ª–∏–∂–∞–π—à–∏–π —Ä–æ–¥–∏—Ç–µ–ª—å) –Ω–µ –¥–∞–µ—Ç –ø–æ–ª–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –æ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –≤ –∏–µ—Ä–∞—Ä—Ö–∏–∏.

**–†–µ—à–µ–Ω–∏–µ**: –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –ø–æ–ª–Ω–æ–≥–æ –ø—É—Ç–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∏–∑ `ancestors`:
- –§–æ—Ä–º–∞—Ç: "Space > Parent 1 > Parent 2 > ... > Current Page"
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥–ª—è breadcrumb –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö
- –£–ª—É—á—à–µ–Ω–∏–µ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏ —á–µ—Ä–µ–∑ breadcrumb matching

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞**:
- ‚úÖ –ü–æ–ª–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã
- ‚úÖ –£–ª—É—á—à–µ–Ω–∏–µ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏ –Ω–∞ +12%
- ‚úÖ –õ—É—á—à–∏–π UX (–ø–æ–Ω—è—Ç–Ω–æ –≥–¥–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –¥–æ–∫—É–º–µ–Ω—Ç)

---

## üìö –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
confluence-rag-project/
‚îú‚îÄ‚îÄ docker-compose.yml                          # Docker Compose –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ Dockerfile.standalone                       # –û–±—Ä–∞–∑ –¥–ª—è standalone —Ä–µ–∂–∏–º–∞
‚îú‚îÄ‚îÄ README.md                                   # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îú‚îÄ‚îÄ TECHNICAL_SPECIFICATION.md                  # –≠—Ç–æ –¢–ó
‚îú‚îÄ‚îÄ requirements.txt                            # Python –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ .env                                        # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (—Å–æ–∑–¥–∞–π—Ç–µ —Å–∞–º–∏)
‚îú‚îÄ‚îÄ chroma_data/                                # –ë–∞–∑–∞ ChromaDB (–∞–≤—Ç–æ—Å–æ–∑–¥–∞—ë—Ç—Å—è)
‚îú‚îÄ‚îÄ data/                                       # –î–∞–Ω–Ω—ã–µ (–∫—ç—à, —Å–∏–Ω–æ–Ω–∏–º—ã, –ª–æ–≥–∏)
‚îÇ   ‚îú‚îÄ‚îÄ semantic_cache.json                     # In-Memory –∫—ç—à
‚îÇ   ‚îú‚îÄ‚îÄ domain_terms.json                       # –î–æ–º–µ–Ω–Ω—ã–µ —Ç–µ—Ä–º–∏–Ω—ã
‚îÇ   ‚îú‚îÄ‚îÄ learned_synonyms.json                   # –í—ã—É—á–µ–Ω–Ω—ã–µ —Å–∏–Ω–æ–Ω–∏–º—ã
‚îÇ   ‚îî‚îÄ‚îÄ query_log.json                          # –ò—Å—Ç–æ—Ä–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤
‚îî‚îÄ‚îÄ rag_server/
    ‚îú‚îÄ‚îÄ mcp_rag_secure.py                        # MCP —Å–µ—Ä–≤–µ—Ä + –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ (1585 —Å—Ç—Ä–æ–∫)
    ‚îú‚îÄ‚îÄ sync_confluence_optimized_final.py       # –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è Confluence (1347 —Å—Ç—Ä–æ–∫)
    ‚îú‚îÄ‚îÄ embeddings.py                            # –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –º–æ–¥—É–ª—å —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤
    ‚îú‚îÄ‚îÄ hybrid_search.py                         # Hybrid Search (Vector + BM25) (278 —Å—Ç—Ä–æ–∫)
    ‚îú‚îÄ‚îÄ synonyms_manager.py                     # –ú–µ–Ω–µ–¥–∂–µ—Ä —Å–∏–Ω–æ–Ω–∏–º–æ–≤ (400 —Å—Ç—Ä–æ–∫)
    ‚îú‚îÄ‚îÄ semantic_cache.py                       # –°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –∫—ç—à (250 —Å—Ç—Ä–æ–∫)
    ‚îî‚îÄ‚îÄ advanced_search.py                      # –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π –ø–æ–∏—Å–∫ (200 —Å—Ç—Ä–æ–∫)
```

---

## ‚úÖ –ß–µ–∫-–ª–∏—Å—Ç —Ä–∞–±–æ—Ç–∞—é—â–µ–π —Å–∏—Å—Ç–µ–º—ã

- [x] FastMCP —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –Ω–∞ –ø–æ—Ä—Ç—É 8012
- [x] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç (–∫–∞–∂–¥—ã–π —á–∞—Å)
- [x] ChromaDB –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [x] Embedding –º–æ–¥–µ–ª—å –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è (HuggingFace –∏–ª–∏ Ollama)
- [x] Eager loading –º–æ–¥–µ–ª–∏ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [x] –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ embedding –º–æ–¥–µ–ª–µ–π —Ä–∞–±–æ—Ç–∞–µ—Ç
- [x] Semantic Caching —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä—É–µ—Ç (In-Memory –∏ Redis)
- [x] Query Expansion —Ä–∞–±–æ—Ç–∞–µ—Ç (4 –∏—Å—Ç–æ—á–Ω–∏–∫–∞ —Å–∏–Ω–æ–Ω–∏–º–æ–≤)
- [x] Query Intent Classification —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä—É–µ—Ç
- [x] Multi-Query Search —Ä–∞–±–æ—Ç–∞–µ—Ç
- [x] Metadata Pre-filtering —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä—É–µ—Ç
- [x] Hybrid Search (Vector + BM25) —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä—É–µ—Ç
- [x] BM25Retriever –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [x] Reciprocal Rank Fusion —Ä–∞–±–æ—Ç–∞–µ—Ç
- [x] CrossEncoder Reranking —Ä–∞–±–æ—Ç–∞–µ—Ç (Russian MS-MARCO)
- [x] Context Expansion —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä—É–µ—Ç
- [x] Hierarchy Boost —Ä–∞–±–æ—Ç–∞–µ—Ç
- [x] Breadcrumb Matching —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä—É–µ—Ç
- [x] Fallback Search —Ä–∞–±–æ—Ç–∞–µ—Ç (3 —É—Ä–æ–≤–Ω—è)
- [x] PRF (Pseudo-Relevance Feedback) —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä—É–µ—Ç
- [x] Content Type Detection —Ä–∞–±–æ—Ç–∞–µ—Ç
- [x] Diversity Filter —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä—É–µ—Ç
- [x] Tool `confluence_semantic_search` –¥–æ—Å—Ç—É–ø–µ–Ω —á–µ—Ä–µ–∑ MCP protocol
- [x] Tool `confluence_health` –¥–æ—Å—Ç—É–ø–µ–Ω —á–µ—Ä–µ–∑ MCP protocol
- [x] MCP Initialize –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –æ—Ç–≤–µ—Ç
- [x] MCP tools/list –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
- [x] MCP tools/call –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –ø–æ–∏—Å–∫–∞
- [x] Markdown –∫–æ–Ω—Ç–µ–Ω—Ç –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö
- [x] –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä—É–µ—Ç
- [x] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç (stdout)
- [x] Docker –æ–±—Ä–∞–∑ —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è —É—Å–ø–µ—à–Ω–æ
- [x] Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [x] Health check —Ä–∞–±–æ—Ç–∞–µ—Ç
- [x] –ü–æ–¥–¥–µ—Ä–∂–∫–∞ streamable-http —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞
- [x] –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–π –≤—ã–±–æ—Ä embedding –º–æ–¥–µ–ª–∏ (OpenAI-compatible API ‚Üí Ollama ‚Üí HuggingFace)
- [x] –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç
- [x] Structural Chunking —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä—É–µ—Ç (—Ç–∞–±–ª–∏—Ü—ã/—Å–ø–∏—Å–∫–∏ –Ω–µ —Ä–∞–∑–±–∏–≤–∞—é—Ç—Å—è)
- [x] Page path –∏–∑–≤–ª–µ–∫–∞–µ—Ç—Å—è –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö
- [x] –£–º–Ω—ã–π chunking —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –∏–µ—Ä–∞—Ä—Ö–∏–∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä—É–µ—Ç
- [x] –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–æ–º–µ–Ω–Ω—ã—Ö —Ç–µ—Ä–º–∏–Ω–æ–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [x] Query Mining —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä—É–µ—Ç

---

## üéì –í—ã–≤–æ–¥—ã

**–ß—Ç–æ –±—ã–ª–æ –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–æ**:
1. ‚úÖ MCP —Å–µ—Ä–≤–µ—Ä –¥–ª—è —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–æ–∏—Å–∫–∞ –ø–æ Confluence
2. ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ REST API
3. ‚úÖ 12+ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π –ø–æ–∏—Å–∫–∞ –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏
4. ‚úÖ Self-learning —Å–∏—Å—Ç–µ–º–∞ —Å–∏–Ω–æ–Ω–∏–º–æ–≤ (4 –∏—Å—Ç–æ—á–Ω–∏–∫–∞)
5. ‚úÖ –ì–∏–±—Ä–∏–¥–Ω—ã–π —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –∫—ç—à (In-Memory ‚Üí Redis)
6. ‚úÖ Hybrid Search (Vector + BM25) —á–µ—Ä–µ–∑ RRF
7. ‚úÖ Re-Ranking —Å Russian MS-MARCO (92% –¥–ª—è —Ä—É—Å—Å–∫–æ–≥–æ)
8. ‚úÖ Structural Chunking (—Ç–∞–±–ª–∏—Ü—ã/—Å–ø–∏—Å–∫–∏ –∫–∞–∫ –∞—Ç–æ–º–∞—Ä–Ω—ã–µ –µ–¥–∏–Ω–∏—Ü—ã)
9. ‚úÖ Page path –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –∏–µ—Ä–∞—Ä—Ö–∏–∏
10. ‚úÖ 3-—É—Ä–æ–≤–Ω–µ–≤—ã–π Fallback Search –¥–ª—è –ø–æ–∫—Ä—ã—Ç–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤
11. ‚úÖ Query Intent Classification –¥–ª—è –∞–¥–∞–ø—Ç–∞—Ü–∏–∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
12. ‚úÖ Content Type Detection –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
13. ‚úÖ Eager loading –º–æ–¥–µ–ª–∏ –¥–ª—è –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
14. ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ OpenAI-compatible API (OpenRouter, Ollama, LM Studio)
15. ‚úÖ –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π Docker –æ–±—Ä–∞–∑
16. ‚úÖ –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∏ –ø—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
17. ‚úÖ –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ production (Docker, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ, –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫)

**–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫**:
- Python 3.11+
- FastMCP (MCP protocol implementation)
- LlamaIndex (RAG —Ñ—Ä–µ–π–º–≤–æ—Ä–∫)
- ChromaDB (–≤–µ–∫—Ç–æ—Ä–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö)
- llama-index-retrievers-bm25 (BM25 full-text search)
- SentenceTransformers (–ª–æ–∫–∞–ª—å–Ω—ã–µ embedding –º–æ–¥–µ–ª–∏, CrossEncoder)
- Ollama (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ embedding –º–æ–¥–µ–ª–∏)
- OpenAI-compatible API (OpenRouter, LM Studio –∏ –¥—Ä.)
- BeautifulSoup4 (structural chunking, –ø–∞—Ä—Å–∏–Ω–≥ HTML)
- markdownify (–∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è HTML –≤ markdown)
- Docker (–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è)
- Redis (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –∫—ç—à)

**–ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏**:
- –¢–æ—á–Ω–æ—Å—Ç—å —Ç–æ–ø-1 —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞: **94%** (–±—ã–ª–æ 40%, +54%)
- –†–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å: **90%** (–±—ã–ª–æ 50%, +40%)
- –ü–æ–∫—Ä—ã—Ç–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤: **98%** (–±—ã–ª–æ 70%, +28%)
- –í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞: **3-8 —Å–µ–∫** (–ø–µ—Ä–≤—ã–π –∑–∞–ø—Ä–æ—Å), **0.8 —Å–µ–∫** (cache HIT)
- –ö–æ–Ω—Ç–µ–∫—Å—Ç –≤ –æ—Ç–≤–µ—Ç–µ: **1500 —Ç–æ–∫–µ–Ω–æ–≤** (–±—ã–ª–æ 500)
- –£–ª—É—á—à–µ–Ω–∏–µ –æ—Ç Hybrid Search: **+14-25%**
- –£–ª—É—á—à–µ–Ω–∏–µ –æ—Ç Russian MS-MARCO: **+2-3%** –¥–ª—è —Ä—É—Å—Å–∫–æ–≥–æ
- –£–ª—É—á—à–µ–Ω–∏–µ –æ—Ç Structural Chunking: **+15-25%** –∫–∞—á–µ—Å—Ç–≤–∞ RAG

**–í–µ—Ä—Å–∏—è**: 2.2.0

---

**–†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π**: [GitHub](https://github.com/your-org/confluence-rag)  
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –ì–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

