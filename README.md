# Confluence RAG

MCP —Å–µ—Ä–≤–µ—Ä –¥–ª—è —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–æ–∏—Å–∫–∞ –ø–æ Confluence —Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π –≤ Open WebUI

## –û–ø–∏—Å–∞–Ω–∏–µ

**Confluence RAG** ‚Äî —ç—Ç–æ MCP (Model Context Protocol) —Å–µ—Ä–≤–µ—Ä –¥–ª—è AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–æ–≤, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—â–∏–π –≤—ã—Å–æ–∫–æ–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω—ã–π —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫ –ø–æ –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω–æ–π –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π Confluence. –°–µ—Ä–≤–µ—Ä –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è –ø–æ–∏—Å–∫–∞ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –∏–∑ —Ç—ã—Å—è—á —Å—Ç—Ä–∞–Ω–∏—Ü –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ç–µ—Ö–Ω–∏–∫ RAG (Retrieval-Augmented Generation).

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**: FastMCP (MCP tools) + LlamaIndex (RAG) + ChromaDB (vector store)

**Python 3.11+**, –º–æ–¥—É–ª—å –∑–∞–ø—É—Å–∫–∞: `python server.py` (MCP —Å–µ—Ä–≤–µ—Ä) + `python sync.py` (—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è)

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- ‚úÖ **–°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫** ‚Äî –≤–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫ –ø–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–º—É –≤—Å–µ—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ Confluence
- ‚úÖ **MCP Streamable HTTP** ‚Äî –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –¥–ª—è Open WebUI –∏ –¥—Ä—É–≥–∏—Ö MCP-–∫–ª–∏–µ–Ω—Ç–æ–≤
- ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è** ‚Äî –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π –∫–∞–∂–¥—ã–π —á–∞—Å
- ‚úÖ **–ì–∏–±—Ä–∏–¥–Ω—ã–µ —ç–º–±–µ–¥–¥–∏–Ω–≥–∏** ‚Äî –ø–æ–¥–¥–µ—Ä–∂–∫–∞ HuggingFace (FRIDA) –∏ Ollama –º–æ–¥–µ–ª–µ–π
- ‚úÖ **–£–º–Ω–æ–µ —Ä–∞–∑–±–∏–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞** ‚Äî chunking —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –∏–µ—Ä–∞—Ä—Ö–∏–∏ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤
- ‚úÖ **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å** ‚Äî –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç 100 –¥–æ 10000+ —Å—Ç—Ä–∞–Ω–∏—Ü —Å –±–∞—Ç—á–∏–Ω–≥–æ–º
- ‚úÖ **Health check** ‚Äî —ç–Ω–¥–ø–æ–∏–Ω—Ç –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏–Ω–¥–µ–∫—Å–∞
- ‚úÖ **–î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** ‚Äî —Ç–∞–π–º–∏–Ω–≥–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
- ‚úÖ **Production-ready** ‚Äî 9 –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π –≤–∫–ª—é—á–µ–Ω—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

### –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ (v2.0)

1. **Query Expansion** ‚Äî —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞ —Å–∏–Ω–æ–Ω–∏–º–∞–º–∏ –∏–∑ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ (+25% –ø–æ–∫—Ä—ã—Ç–∏–µ)
2. **Adaptive Rerank Limit** ‚Äî —É–º–Ω–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤ –¥–ª—è reranking
3. **Metadata Pre-filtering** ‚Äî —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –î–û –≤–µ–∫—Ç–æ—Ä–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞ (+30% —Å–∫–æ—Ä–æ—Å—Ç—å)
4. **Fallback Strategies** ‚Äî 3-—É—Ä–æ–≤–Ω–µ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ –ø–æ–∏—Å–∫–∞ (98% –ø–æ–∫—Ä—ã—Ç–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤)
5. **Deduplication** ‚Äî —É–¥–∞–ª–µ–Ω–∏–µ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –æ—Ç multi-query search
6. **CrossEncoder Reranking** ‚Äî –ø–µ—Ä–µ—Ä–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏–µ —Å Russian MS-MARCO (+40% —Ç–æ—á–Ω–æ—Å—Ç—å, –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–µ –ø–æ—Ä–æ–≥–∏)
7. **Context Window Expansion** ‚Äî —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ —Å–æ—Å–µ–¥–Ω–∏–º–∏ —á–∞–Ω–∫–∞–º–∏ (3x –±–æ–ª—å—à–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏)
8. **Hierarchy Boost** ‚Äî —É—á–µ—Ç –≤–∞–∂–Ω–æ—Å—Ç–∏ —Å—Ç—Ä–∞–Ω–∏—Ü –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ Confluence
9. **Breadcrumb Path Matching** ‚Äî —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞ —Å –ø—É—Ç–µ–º –¥–æ–∫—É–º–µ–Ω—Ç–∞ (+15% —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å)

### –ù–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ (v2.1)

- ‚úÖ **Self-Learning Synonyms** ‚Äî —Å–∞–º–æ–æ–±—É—á–∞—é—â–∞—è—Å—è —Å–∏—Å—Ç–µ–º–∞ —Å–∏–Ω–æ–Ω–∏–º–æ–≤ (Query Mining)
- ‚úÖ **Semantic Caching** ‚Äî –≥–∏–±—Ä–∏–¥–Ω—ã–π –∫—ç—à (In-Memory ‚Üí Redis –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- ‚úÖ **Pseudo-Relevance Feedback (PRF)** ‚Äî –¥–≤—É—Ö—ç—Ç–∞–ø–Ω—ã–π –ø–æ–∏—Å–∫ —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ–º –∑–∞–ø—Ä–æ—Å–∞
- ‚úÖ **Query Rewriting** ‚Äî –ø–µ—Ä–µ—Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ —á–µ—Ä–µ–∑ Ollama (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- ‚úÖ **Content Type Detection** ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü, —Å–ø–∏—Å–∫–æ–≤, –∫–æ–¥–∞
- ‚úÖ **Query Intent Classification** ‚Äî –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –Ω–∞–º–µ—Ä–µ–Ω–∏–π (navigational, how-to, factual)

### –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã (Tools) –¥–æ—Å—Ç—É–ø–Ω—ã–µ —á–µ—Ä–µ–∑ MCP

- **confluence_semantic_search** ‚Äî —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫ –ø–æ –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π Confluence

  **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
  - `query` (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π) ‚Äî –ø–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å (2-1000 —Å–∏–º–≤–æ–ª–æ–≤)
  - `limit` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `5`) ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ (1-20)
  - `space` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) ‚Äî —Ñ–∏–ª—å—Ç—Ä –ø–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤—É Confluence

  **–ü—Ä–∏–º–µ—Ä—ã:**
  ```
  –ù–∞–π–¥–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø—Ä–æ—Ü–µ—Å—Å–µ –¥–µ–ø–ª–æ—è –≤ space DEVOPS
  –ö–∞–∫–∏–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ –ø—Ä–æ–µ–∫—Ç–µ RAUII?
  –ì–¥–µ –æ–ø–∏—Å–∞–Ω—ã –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –¥–ª—è API?
  ```

- **confluence_health** ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –∏–Ω–¥–µ–∫—Å–∞

  **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –≤ –±–∞–∑–µ, —Å—Ç–∞—Ç—É—Å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

### –î–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

- **Docker** 24+ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
- **Docker Compose** 2.0+ (–¥–ª—è multi-container setup)
- **Python 3.11+** (–¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)

### –î–ª—è MCP —Å–µ—Ä–≤–µ—Ä–∞

- **MCP –∫–ª–∏–µ–Ω—Ç**: Open WebUI, Claude Desktop, Cursor IDE –∏–ª–∏ –¥—Ä—É–≥–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º—ã–π MCP –∫–ª–∏–µ–Ω—Ç
- **Confluence API Token**: –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π —Ç–æ–∫–µ–Ω –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ Confluence API
- **–°–µ—Ç–µ–≤–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ**: –î–ª—è —Ä–∞–±–æ—Ç—ã —Å Confluence Cloud/Server
- **–†–µ—Å—É—Ä—Å—ã**: ~4GB RAM, ~3GB disk (–¥–ª—è —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤ –∏ ChromaDB)

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

#### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ

- `CONFLUENCE_URL` ‚Äî URL –≤–∞—à–µ–≥–æ Confluence (—Å `/` –≤ –∫–æ–Ω—Ü–µ)
- `CONFLUENCE_TOKEN` ‚Äî API —Ç–æ–∫–µ–Ω Confluence

#### –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ (—Å –∑–Ω–∞—á–µ–Ω–∏—è–º–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)

**ChromaDB:**
- `CHROMA_PATH` ‚Äî –ø—É—Ç—å –∫ –±–∞–∑–µ ChromaDB (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `./chroma_data`)
- `STATE_FILE` ‚Äî —Ñ–∞–π–ª —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `./sync_state.json`)

**–≠–º–±–µ–¥–¥–∏–Ω–≥–∏:**
- `OPENAI_API_BASE` ‚Äî URL OpenAI-compatible API
  - OpenRouter: `https://openrouter.ai/api/v1`
  - Ollama: `http://localhost:11434/v1`
  - LM Studio –∏ –¥—Ä.
- `OPENAI_API_KEY` ‚Äî API –∫–ª—é—á
  - OpenRouter: –≤–∞—à API –∫–ª—é—á (sk-or-v1-...)
  - Ollama: –æ–±—ã—á–Ω–æ `ollama` –∏–ª–∏ –Ω–µ –Ω—É–∂–µ–Ω
- `OPENAI_MODEL` ‚Äî –∏–º—è –º–æ–¥–µ–ª–∏ –¥–ª—è API (–µ—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω–æ, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `EMBED_MODEL`)
  - OpenRouter: `qwen/qwen3-embedding-8b`, `qwen/qwen3-embedding-4b`, `qwen/qwen3-embedding-1.7b` –∏ –¥—Ä.
  - Ollama: `nomic-embed-text`, `all-minilm`, `qwen3-embedding-4b` –∏ –¥—Ä.
- `USE_OLLAMA` ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Ollama —á–µ—Ä–µ–∑ LlamaIndex (`true|false`, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `false`)
- `OLLAMA_URL` ‚Äî URL Ollama —Å–µ—Ä–≤–µ—Ä–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `http://ollama:11434`)
- `EMBED_MODEL` ‚Äî –º–æ–¥–µ–ª—å —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤ (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –µ—Å–ª–∏ `OPENAI_API_BASE` –Ω–µ —É–∫–∞–∑–∞–Ω, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `ai-forever/FRIDA`)

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –≤—ã–±–æ—Ä–∞ –º–æ–¥–µ–ª–∏:**
1. OpenAI-compatible API (–µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω `OPENAI_API_BASE`)
   - OpenRouter (–æ–±–ª–∞—á–Ω—ã–π —Å–µ—Ä–≤–∏—Å) ‚Äî —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è –º–æ—â–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π
   - Ollama (–ª–æ–∫–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä)
   - LM Studio –∏ –¥—Ä.
2. Ollama —á–µ—Ä–µ–∑ LlamaIndex (–µ—Å–ª–∏ `USE_OLLAMA=true`)
3. HuggingFace (–ª–æ–∫–∞–ª—å–Ω–æ, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)

**–í–ê–ñ–ù–û:** –ï—Å–ª–∏ —É–∫–∞–∑–∞–Ω–∞ –º–æ–¥–µ–ª—å, –æ–Ω–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –¥–æ—Å—Ç—É–ø–Ω–∞. –ù–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ fallback –º–µ–∂–¥—É –º–æ–¥–µ–ª—è–º–∏. –ü—Ä–∏ —Å–º–µ–Ω–µ –º–æ–¥–µ–ª–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —É–¥–∞–ª–∏—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –≤—Ä—É—á–Ω—É—é.

**–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è:**
- `SYNC_INTERVAL` ‚Äî –∏–Ω—Ç–µ—Ä–≤–∞–ª —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –≤ —Å–µ–∫—É–Ω–¥–∞—Ö (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `3600` ‚Äî 1 —á–∞—Å)
- `BATCH_SIZE` ‚Äî —Ä–∞–∑–º–µ—Ä –±–∞—Ç—á–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `50`)
- `MAX_SPACES` ‚Äî –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `10`)
- `CONFLUENCE_SPACES` ‚Äî —Ñ–∏–ª—å—Ç—Ä –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤ –¥–ª—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏ (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é, –Ω–∞–ø—Ä–∏–º–µ—Ä: `RAUII,MAP,MD`)
  - –ï—Å–ª–∏ —É–∫–∞–∑–∞–Ω, –∏–Ω–¥–µ–∫—Å–∏—Ä—É—é—Ç—Å—è —Ç–æ–ª—å–∫–æ —É–∫–∞–∑–∞–Ω–Ω—ã–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞
  - –ï—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `MAX_SPACES` (–ø–µ—Ä–≤—ã–µ N –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤)
  - **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –ï—Å–ª–∏ —É–∫–∞–∑–∞–Ω—ã –æ–±–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ (`CONFLUENCE_SPACES` –∏ `MAX_SPACES`), –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `CONFLUENCE_SPACES`, –∞ `MAX_SPACES` –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è (–≤ –ª–æ–≥–∞—Ö –±—É–¥–µ—Ç –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ)
  - –ü—Ä–∏–º–µ—Ä: `CONFLUENCE_SPACES=RAUII,MAP,MD,MI`
- `MAX_CHUNK_SIZE` ‚Äî —Ä–∞–∑–º–µ—Ä —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ —á–∞–Ω–∫–∞ –≤ —Å–∏–º–≤–æ–ª–∞—Ö (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `500`)
- `MIN_TEXT_LEN` ‚Äî –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ —Ç–µ–∫—Å—Ç–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –¥–ª—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `50`)

**Semantic Caching:**
- `USE_REDIS_CACHE` ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Redis –¥–ª—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è (`true|false`, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `false`)
- `CACHE_TTL` ‚Äî –≤—Ä–µ–º—è –∂–∏–∑–Ω–∏ –∫—ç—à–∞ –≤ —Å–µ–∫—É–Ω–¥–∞—Ö (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `3600` ‚Äî 1 —á–∞—Å)

**Query Expansion:**
- `USE_STATIC_SYNONYMS` ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–∞–∑–æ–≤—ã–π —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–ª–æ–≤–∞—Ä—å —Å–∏–Ω–æ–Ω–∏–º–æ–≤ (`true|false`, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `true`)
- `USE_OLLAMA_FOR_QUERY_EXPANSION` ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Ollama –¥–ª—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ (`true|false`, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `false`)
- `OLLAMA_MODEL_FOR_EXPANSION` ‚Äî –º–æ–¥–µ–ª—å Ollama –¥–ª—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `llama3.2`)

**Fallback Search:**
- `ENABLE_AUTO_FALLBACK` ‚Äî –≤–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π Fallback (`true|false`, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `true`)
- `ENABLE_PRF_FALLBACK` ‚Äî –≤–∫–ª—é—á–∏—Ç—å PRF –∫–∞–∫ Fallback (`true|false`, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `true`)
- `MIN_FALLBACK_RESULTS` ‚Äî –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –¥–ª—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ Fallback (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `3`)

**–ü—Ä–æ—á–∏–µ:**
- `LOG_LEVEL` ‚Äî —É—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è `DEBUG|INFO|WARNING|ERROR` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `INFO`)
- `VERIFY_SSL` ‚Äî –ø—Ä–æ–≤–µ—Ä—è—Ç—å SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã (`true|false`, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `true`)
- `RE_RANKER_MODEL` ‚Äî –º–æ–¥–µ–ª—å –¥–ª—è CrossEncoder reranking (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `DiTy/cross-encoder-russian-msmarco`)
- `RERANK_THRESHOLD_TECHNICAL` ‚Äî –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π rerank score –¥–ª—è —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `0.01`)
- `RERANK_THRESHOLD_GENERAL` ‚Äî –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π rerank score –¥–ª—è –æ–±—â–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `0.005`)
  
  **–í–ê–ñ–ù–û:** –î–∏–∞–ø–∞–∑–æ–Ω scores –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –º–æ–¥–µ–ª–∏! –î–ª—è `DiTy/cross-encoder-russian-msmarco` scores –æ–±—ã—á–Ω–æ –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ 0-1 (0.001 - 0.295). –ü–æ—Ä–æ–≥–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ –∞–Ω–∞–ª–∏–∑–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö scores.

### –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

–í—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –≤–∫–ª—é—á–µ–Ω—ã –≤ Docker –æ–±—Ä–∞–∑:

- FastMCP 2.13+ ‚Äî MCP —Å–µ—Ä–≤–µ—Ä–Ω–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞
- LlamaIndex 0.10+ ‚Äî RAG —Ñ—Ä–µ–π–º–≤–æ—Ä–∫
- ChromaDB 0.4+ ‚Äî –≤–µ–∫—Ç–æ—Ä–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- SentenceTransformers 2.3+ ‚Äî –¥–ª—è HuggingFace —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤
- Transformers 4.35+ ‚Äî –¥–ª—è –º–æ–¥–µ–ª–µ–π
- Torch 2.0+ ‚Äî –¥–ª—è ML –≤—ã—á–∏—Å–ª–µ–Ω–∏–π
- httpx ‚Äî –¥–ª—è HTTP –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ Confluence API
- python-dotenv ‚Äî –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

## –°–±–æ—Ä–∫–∞

–ü—Ä–æ–µ–∫—Ç —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è —Å –ø–æ–º–æ—â—å—é Docker. –î–ª—è —Å–±–æ—Ä–∫–∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–ª–µ–¥—É—é—â—É—é –∫–æ–º–∞–Ω–¥—É –≤ –∫–æ—Ä–Ω–µ–≤–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞:

```bash
docker build -f Dockerfile.standalone -t confluence-rag:latest .
```

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π —Å–±–æ—Ä–∫–∏ –æ–±—Ä–∞–∑ –±—É–¥–µ—Ç –≥–æ—Ç–æ–≤ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è.

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ó–∞–ø—É—Å–∫ MCP —Å–µ—Ä–≤–µ—Ä–∞

#### Docker (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```bash
# –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç —Å –≥–æ—Ç–æ–≤—ã–º –æ–±—Ä–∞–∑–æ–º
docker run --rm \
  -p 8012:8012 \
  -e CONFLUENCE_URL="https://your-confluence.atlassian.net/" \
  -e CONFLUENCE_TOKEN="<–≤–∞—à_—Ç–æ–∫–µ–Ω>" \
  -v $(pwd)/chroma_data:/app/chroma_data \
  -v $(pwd)/data:/app/data \
  --name confluence-rag \
  confluence-rag:latest
```

#### docker-compose (–¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞)

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `docker-compose.yml`:

```yaml
services:
  confluence-rag:
    build:
      context: .
      dockerfile: Dockerfile.standalone
    container_name: confluence-rag
    ports:
      - "8012:8012"
    networks:
      - your-network
    environment:
      - CONFLUENCE_URL=${CONFLUENCE_URL}
      - CONFLUENCE_TOKEN=${CONFLUENCE_TOKEN}
      - CHROMA_PATH=/app/chroma_data
      - SYNC_INTERVAL=${SYNC_INTERVAL:-3600}
      - OPENAI_API_BASE=${OPENAI_API_BASE:-}
      - OPENAI_API_KEY=${OPENAI_API_KEY:-ollama}
      - OPENAI_MODEL=${OPENAI_MODEL:-}
      - USE_OLLAMA=${USE_OLLAMA:-false}
      - OLLAMA_URL=${OLLAMA_URL:-http://ollama:11434}
      - EMBED_MODEL=${EMBED_MODEL:-ai-forever/FRIDA}
    volumes:
      - ./chroma_data:/app/chroma_data
      - ./data:/app/data
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8012/health"]
      interval: 30s
      timeout: 10s
      retries: 3
```

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env`:

```env
CONFLUENCE_URL=https://your-confluence.atlassian.net/
CONFLUENCE_TOKEN=<–≤–∞—à_—Ç–æ–∫–µ–Ω>
SYNC_INTERVAL=3600

# –î–ª—è OpenRouter (–æ–±–ª–∞—á–Ω—ã–π —Å–µ—Ä–≤–∏—Å, —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è –º–æ—â–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π)
OPENAI_API_BASE=https://openrouter.ai/api/v1
OPENAI_API_KEY=sk-or-v1-–≤–∞—à-–∫–ª—é—á
OPENAI_MODEL=qwen/qwen3-embedding-8b

# –ò–ª–∏ –¥–ª—è Ollama —á–µ—Ä–µ–∑ OpenAI-compatible API
# OPENAI_API_BASE=http://ollama:11434/v1
# OPENAI_MODEL=nomic-embed-text

# –ò–ª–∏ —á–µ—Ä–µ–∑ LlamaIndex (–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞)
# USE_OLLAMA=true
# OLLAMA_URL=http://ollama:11434
# EMBED_MODEL=nomic-embed-text
```

–ó–∞–ø—É—Å–∫:

```bash
docker compose up -d
```

#### –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
pip install -r requirements.txt

# –ó–∞–ø—É—Å–∫ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ (–≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ)
python rag_server/sync_confluence_optimized_final.py

# –ó–∞–ø—É—Å–∫ MCP —Å–µ—Ä–≤–µ—Ä–∞
python rag_server/mcp_rag_secure.py
```

**–û–ø—Ü–∏–∏ –∑–∞–ø—É—Å–∫–∞ —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:**

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞ (—Å–º. `ENV_TEMPLATE` –¥–ª—è –ø—Ä–∏–º–µ—Ä–∞):

```env
CONFLUENCE_URL=https://your-confluence.atlassian.net/
CONFLUENCE_TOKEN=<–≤–∞—à_—Ç–æ–∫–µ–Ω>
CHROMA_PATH=./chroma_data
SYNC_INTERVAL=3600
USE_OLLAMA=false
EMBED_MODEL=ai-forever/FRIDA
```

**–ü—Ä–∏–º–µ—Ä—ã:**

```bash
# –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –∑–∞–ø—É—Å–∫ (HuggingFace)
python rag_server/mcp_rag_secure.py

# –° –∫–∞—Å—Ç–æ–º–Ω—ã–º –ø–æ—Ä—Ç–æ–º (—á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ .env)
LOG_LEVEL=DEBUG python rag_server/mcp_rag_secure.py

# –° OpenRouter (–æ–±–ª–∞—á–Ω—ã–π —Å–µ—Ä–≤–∏—Å, —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è –º–æ—â–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π)
OPENAI_API_BASE=https://openrouter.ai/api/v1 OPENAI_API_KEY=sk-or-v1-–≤–∞—à-–∫–ª—é—á OPENAI_MODEL=qwen/qwen3-embedding-8b python rag_server/mcp_rag_secure.py

# –° Ollama —á–µ—Ä–µ–∑ OpenAI-compatible API
OPENAI_API_BASE=http://localhost:11434/v1 OPENAI_MODEL=nomic-embed-text python rag_server/mcp_rag_secure.py

# –° Ollama —á–µ—Ä–µ–∑ LlamaIndex (–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞)
USE_OLLAMA=true OLLAMA_URL=http://localhost:11434 EMBED_MODEL=nomic-embed-text python rag_server/mcp_rag_secure.py
```

## –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã

### MCP protocol (–¥–ª—è MCP-–∫–ª–∏–µ–Ω—Ç–æ–≤)

- **FastMCP**: `http://your-host:8012/mcp` ‚Äî MCP Streamable HTTP
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ SSE/WebSocket
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ—Å—Ç—É–ø–µ–Ω –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ —Å–µ—Ä–≤–µ—Ä–∞

### Health check

- **Health**: `GET /health` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å AI –∫–ª–∏–µ–Ω—Ç–∞–º–∏

### Open WebUI

**–í–∞—Ä–∏–∞–Ω—Ç 1: MCP Streamable HTTP (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)**

1. –û—Ç–∫—Ä–æ–π—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Open WebUI
2. –î–æ–±–∞–≤—å—Ç–µ –Ω–æ–≤—ã–π MCP —Å–µ—Ä–≤–µ—Ä
3. –í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø: **MCP Streamable HTTP**
4. –£–∫–∞–∂–∏—Ç–µ:
   - **URL**: `http://confluence-rag:8012/mcp` (–≤–Ω—É—Ç—Ä–∏ Docker —Å–µ—Ç–∏) –∏–ª–∏ `http://host.docker.internal:8012/mcp` (–∏–∑ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞)
   - **–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è**: –ë–µ–∑ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

> **–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ**: 
> - –ï—Å–ª–∏ Open WebUI –≤ Docker –∏ –æ–±–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –≤ –æ–¥–Ω–æ–π —Å–µ—Ç–∏, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∏–º—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ `confluence-rag:8012`
> - –ï—Å–ª–∏ Open WebUI –Ω–∞ —Ö–æ—Å—Ç–µ, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `localhost:8012` –∏–ª–∏ `host.docker.internal:8012`

### Claude Desktop

–î–æ–±–∞–≤—å—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –≤ `claude_desktop_config.json`:

```json
{
  "mcpServers": {
    "confluence-rag": {
      "url": "http://localhost:8012/mcp"
    }
  }
}
```

### Cursor IDE

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.cursor/mcp.json` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞:

```json
{
  "mcpServers": {
    "confluence-rag": {
      "url": "http://localhost:8012/mcp"
    }
  }
}
```

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü—Ä–∏–º–µ—Ä MCP –∑–∞–ø—Ä–æ—Å–∞

```bash
curl -X POST http://localhost:8012/mcp \
  -H "Content-Type: application/json" \
  -H "Accept: application/json, text/event-stream" \
  -d '{
    "jsonrpc": "2.0",
    "id": "req-1",
    "method": "tools/call",
    "params": {
      "name": "confluence_semantic_search",
      "arguments": {
        "query": "–ö–∞–∫–∏–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ –ø—Ä–æ–µ–∫—Ç–µ RAUII?",
        "limit": 5,
        "space": "RAUII"
      }
    }
  }'
```

### –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ Open WebUI

–ü–æ—Å–ª–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è MCP —Å–µ—Ä–≤–µ—Ä–∞, –≤—ã –º–æ–∂–µ—Ç–µ –∑–∞–¥–∞–≤–∞—Ç—å –≤–æ–ø—Ä–æ—Å—ã –Ω–∞–ø—Ä—è–º—É—é:

```
–ù–∞–π–¥–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø—Ä–æ—Ü–µ—Å—Å–µ –¥–µ–ø–ª–æ—è –≤ space DEVOPS
```

```
–ö–∞–∫–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –Ω—É–∂–Ω–æ —É—á–µ—Å—Ç—å –ø—Ä–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ API?
```

```
–ß—Ç–æ –±—ã–ª–æ –Ω–∞ –ö–æ–Ω—Ñ–µ—Ä–µ–Ω—Ü–∏—è –ø–æ –≤–∞–π–± –∫–æ–¥–∏–Ω–≥—É –Ω–∞ 1–°?
```

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –û–±—â–∞—è —Å—Ö–µ–º–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Confluence    ‚îÇ
‚îÇ     Cloud       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ API
         ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Sync Service   ‚îÇ ‚Üê –ö–∞–∂–¥—ã–π —á–∞—Å (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è)
‚îÇ  (Python)       ‚îÇ
‚îÇ  Smart Chunking ‚îÇ ‚Üê –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–µ—Ä–∞—Ä—Ö–∏–∏
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ Chunks + Embeddings
         ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   ChromaDB      ‚îÇ ‚Üê Vector Store
‚îÇ  (Persistent)   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   MCP Server :8012/mcp              ‚îÇ
‚îÇ   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ   ‚îÇ  Advanced Search Pipeline   ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ  ‚Ä¢ Query Expansion          ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ  ‚Ä¢ Semantic Caching          ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ  ‚Ä¢ Metadata Pre-filtering   ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ  ‚Ä¢ Multi-Query Search       ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ  ‚Ä¢ Deduplication            ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ  ‚Ä¢ CrossEncoder Reranking   ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ  ‚Ä¢ Context Expansion        ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ  ‚Ä¢ Hierarchy Boost          ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ  ‚Ä¢ Breadcrumb Matching      ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ  ‚Ä¢ Fallback Search (3 lvl)  ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ  ‚Ä¢ PRF (Pseudo-Relevance)   ‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Open WebUI    ‚îÇ ‚Üê LLM Tools
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### Pipeline –ø–æ–∏—Å–∫–∞ (–¥–µ—Ç–∞–ª—å–Ω–æ)

```
1. –ü–†–ï–î–û–ë–†–ê–ë–û–¢–ö–ê –ó–ê–ü–†–û–°–ê
   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
   ‚îÇ "—Å—Ç–µ–∫ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π RAUII"  ‚îÇ
   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                ‚îÇ
                ‚Üì
   Semantic Cache Check
   ‚îú‚îÄ Cache HIT ‚Üí –≤–æ–∑–≤—Ä–∞—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ (0.8 —Å–µ–∫)
   ‚îî‚îÄ Cache MISS ‚Üí –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ
                ‚îÇ
                ‚Üì
   Query Intent Classification
   ‚îú‚îÄ Type: exploratory
   ‚îú‚îÄ Diversity: 2
   ‚îî‚îÄ Expand Context: true
                ‚îÇ
                ‚Üì
   Query Expansion (5 –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤)
   ‚îú‚îÄ "—Å—Ç–µ–∫ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π RAUII"
   ‚îú‚îÄ "—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫ RAUII"
   ‚îú‚îÄ "–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ RAUII"
   ‚îú‚îÄ "—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π RAUII"
   ‚îî‚îÄ "—Å—Ç–µ–∫ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π RAUII RAUII"
                ‚îÇ
                ‚Üì
   Adaptive Candidate Limit
   2 —Å–ª–æ–≤–∞ ‚Üí 25 –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤

2. –ü–û–ò–°–ö –ò –§–ò–õ–¨–¢–†–ê–¶–ò–Ø
   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
   ‚îÇ  ChromaDB Query          ‚îÇ
   ‚îÇ  + Metadata Filter       ‚îÇ
   ‚îÇ  (space="RAUII")         ‚îÇ
   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                ‚îÇ
                ‚Üì
   Multi-Query Search
   35 —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –Ω–∞–π–¥–µ–Ω–æ
                ‚îÇ
                ‚Üì
   Deduplication
   28 —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö

3. –†–ê–ù–ñ–ò–†–û–í–ê–ù–ò–ï
   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
   ‚îÇ  CrossEncoder Reranking  ‚îÇ
   ‚îÇ  (ms-marco-MiniLM)       ‚îÇ
   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                ‚îÇ
                ‚Üì
   Scores: [7.2, 6.8, 5.1, ...]
                ‚îÇ
                ‚Üì
   Context Expansion (¬±1 —á–∞–Ω–∫)
   + Hierarchy Boost (+0.8)
   + Breadcrumb Match (+0.4)
                ‚îÇ
                ‚Üì
   Final Score: 8.4 üî•

4. FALLBACK (–µ—Å–ª–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ < 3)
   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
   ‚îÇ  Fallback Level 1        ‚îÇ
   ‚îÇ  –£–±–∏—Ä–∞–µ–º space —Ñ–∏–ª—å—Ç—Ä    ‚îÇ
   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                ‚îÇ
                ‚Üì (–µ—Å–ª–∏ –≤—Å—ë –µ—â—ë < 3)
   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
   ‚îÇ  Fallback Level 2        ‚îÇ
   ‚îÇ  PRF (Pseudo-Relevance)  ‚îÇ
   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                ‚îÇ
                ‚Üì (–µ—Å–ª–∏ –≤—Å—ë –µ—â—ë < 3)
   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
   ‚îÇ  Fallback Level 3        ‚îÇ
   ‚îÇ  –°–Ω–∏–∂–∞–µ–º –ø–æ—Ä–æ–≥ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏‚îÇ
   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

5. –†–ï–ó–£–õ–¨–¢–ê–¢
   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
   ‚îÇ üìç –ù–ò–ò –†–ê–£ –ò–ò ‚Üí –û–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è    ‚îÇ
   ‚îÇ    ‚Üí –°—Ç–µ–∫ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π                ‚îÇ
   ‚îÇ üî• 8.40 (base:7.2, +hier:0.8,       ‚îÇ
   ‚îÇ         +path:0.4)                   ‚îÇ
   ‚îÇ üìö 3 chunks (—Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç)  ‚îÇ
   ‚îÇ üí¨ –†–∞–±–æ—Ç–∞ —Å –ò–ò –º–æ–¥–µ–ª—è–º–∏: Ollama...  ‚îÇ
   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                ‚îÇ
                ‚Üì
   Semantic Cache Save
   (–¥–ª—è —Å–ª–µ–¥—É—é—â–∏—Ö –ø–æ—Ö–æ–∂–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤)
```

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π

### 1. Query Expansion

**–ò—Å—Ç–æ—á–Ω–∏–∫–∏ —Å–∏–Ω–æ–Ω–∏–º–æ–≤:**
- –ë–∞–∑–æ–≤—ã–π —Å–ª–æ–≤–∞—Ä—å (50 –æ–±—â–∏—Ö IT-—Ç–µ—Ä–º–∏–Ω–æ–≤)
- –î–æ–º–µ–Ω–Ω—ã–µ —Ç–µ—Ä–º–∏–Ω—ã (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–∑ Confluence: spaces, –∞–±–±—Ä–µ–≤–∏–∞—Ç—É—Ä—ã)
- –í—ã—É—á–µ–Ω–Ω—ã–µ —Å–∏–Ω–æ–Ω–∏–º—ã (Query Mining ‚Äî –≥—Ä–∞—Ñ —Å–æ–≤–º–µ—Å—Ç–Ω–æ–π –≤—Å—Ç—Ä–µ—á–∞–µ–º–æ—Å—Ç–∏)
- Ollama (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω)

**–ê–ª–≥–æ—Ä–∏—Ç–º:**
- –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤ –∏–∑ –∑–∞–ø—Ä–æ—Å–∞
- –ó–∞–º–µ–Ω–∞ –Ω–∞ —Å–∏–Ω–æ–Ω–∏–º—ã —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º word boundaries (`\b`)
- –ó–∞—â–∏—Ç–∞ –æ—Ç –∑–∞–º–µ–Ω—ã blacklist —Ç–µ—Ä–º–∏–Ω–æ–≤ (—Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ –∏–º–µ–Ω–∞, –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã)
- –ê–¥–∞–ø—Ç–∏–≤–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ (2-5) –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –¥–ª–∏–Ω—ã –∑–∞–ø—Ä–æ—Å–∞

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** 1 –∑–∞–ø—Ä–æ—Å ‚Üí 2-5 –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤, +25% –ø–æ–∫—Ä—ã—Ç–∏–µ

### 2. Semantic Caching

**–†–µ–∂–∏–º—ã:**
- In-Memory (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) ‚Äî –±—ã—Å—Ç—Ä—ã–π, –Ω–æ —Ç–µ—Ä—è–µ—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ
- Redis (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) ‚Äî –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω—ã–π, –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º—ã–π

**–ê–ª–≥–æ—Ä–∏—Ç–º:**
- –°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ (cosine similarity embeddings)
- TTL: 1 —á–∞—Å (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö –∑–∞–ø–∏—Å–µ–π

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** Cache HIT: -90% –≤—Ä–µ–º–µ–Ω–∏ (0.8 —Å–µ–∫ –≤–º–µ—Å—Ç–æ 8 —Å–µ–∫)

### 3. Adaptive Rerank Limit

```python
query_words <= 2: rerank_limit = 20  # –ö–æ—Ä–æ—Ç–∫–∏–π –∑–∞–ø—Ä–æ—Å ‚Üí –±–æ–ª—å—à–µ –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤
query_words <= 4: rerank_limit = 15  # –°—Ä–µ–¥–Ω–∏–π –∑–∞–ø—Ä–æ—Å
query_words > 4:  rerank_limit = 10  # –î–ª–∏–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å —Å–ø–µ—Ü–∏—Ñ–∏—á–µ–Ω
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ë–∞–ª–∞–Ω—Å —Å–∫–æ—Ä–æ—Å—Ç—å/–∫–∞—á–µ—Å—Ç–≤–æ, -30% –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞ reranking

### 4. Metadata Pre-filtering

- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è ChromaDB WHERE clause –î–û –≤–µ–∫—Ç–æ—Ä–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞
- –ü—Ä—è–º—ã–µ SQL-like –∑–∞–ø—Ä–æ—Å—ã –∫ metadata
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** -50% –ª–æ–∂–Ω—ã—Ö —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–π, +30% —Å–∫–æ—Ä–æ—Å—Ç—å

### 5. Fallback Strategies (3 —É—Ä–æ–≤–Ω—è)

```
–ü–æ–ø—ã—Ç–∫–∞ 1: –ü–æ–ª–Ω—ã–π –∑–∞–ø—Ä–æ—Å + —Ñ–∏–ª—å—Ç—Ä space
–ü–æ–ø—ã—Ç–∫–∞ 2: –ü–æ–ª–Ω—ã–π –∑–∞–ø—Ä–æ—Å –ë–ï–ó —Ñ–∏–ª—å—Ç—Ä–∞ (–µ—Å–ª–∏ < 3 —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤)
–ü–æ–ø—ã—Ç–∫–∞ 3: PRF (Pseudo-Relevance Feedback) + —Å–Ω–∏–∂–µ–Ω–∏–µ –ø–æ—Ä–æ–≥–∞ (–µ—Å–ª–∏ < 3 —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤)
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** 98% –ø–æ–∫—Ä—ã—Ç–∏–µ –ª—é–±—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

### 6. CrossEncoder Reranking

- –ú–æ–¥–µ–ª—å: `cross-encoder/ms-marco-MiniLM-L-6-v2` (90MB)
- –¢–æ—á–Ω—ã–π —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π matching (query, document) –ø–∞—Ä—ã
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** +40% —Ç–æ—á–Ω–æ—Å—Ç—å —Ç–æ–ø-1

### 7. Context Window Expansion

- –ù–∞—Ö–æ–¥–∏–º —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–π chunk #N
- –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º chunks [N-1, N, N+1] –∏–∑ —Ç–æ–π –∂–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
- –û–±—ä–µ–¥–∏–Ω—è–µ–º –≤ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** 3x –±–æ–ª—å—à–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –¥–ª—è LLM

### 8. Hierarchy Boost

```python
–ö–æ—Ä–Ω–µ–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ (–Ω–µ—Ç parent):     +0.5
–ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –≤ title:              +0.3
  - "–æ–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è", "–≥–ª–∞–≤–Ω–∞—è", "readme"
H1 –∑–∞–≥–æ–ª–æ–≤–æ–∫:                        +0.2
H2 –∑–∞–≥–æ–ª–æ–≤–æ–∫:                        +0.1
Labels –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç:                 +0.05
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –í–∞–∂–Ω—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø–æ–¥–Ω–∏–º–∞—é—Ç—Å—è –Ω–∞–≤–µ—Ä—Ö

### 9. Breadcrumb Path Matching

- Jaccard similarity –º–µ–∂–¥—É query –∏ breadcrumb
- –ü—Ä–∏–º–µ—Ä—ã:
  - Query: "RAUII —Å—Ç–µ–∫ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π"
  - Breadcrumb: "RAUII ‚Üí –°—Ç–µ–∫ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π"
  - Score: 0.8 ‚Üí +0.16 –∫ —Ñ–∏–Ω–∞–ª—å–Ω–æ–º—É score
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** +15% —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å

### 10. Content Type Detection

- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞: `table`, `list`, `code`, `text`
- –ê–¥–∞–ø—Ç–∏–≤–Ω–æ–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ snippet:
  - –¢–∞–±–ª–∏—Ü—ã/—Å–ø–∏—Å–∫–∏: –¥–æ 2400 —Å–∏–º–≤–æ–ª–æ–≤ (–ø–æ–ª–Ω–æ—Å—Ç—å—é)
  - –ö–æ–¥: –¥–æ 1200 —Å–∏–º–≤–æ–ª–æ–≤
  - –¢–µ–∫—Å—Ç: –¥–æ 400 —Å–∏–º–≤–æ–ª–æ–≤

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ü–æ–ª–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –¥–ª—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞

### 11. Query Intent Classification

- –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –Ω–∞–º–µ—Ä–µ–Ω–∏–π: `navigational`, `howto`, `factual`, `exploratory`
- –ê–¥–∞–ø—Ç–∞—Ü–∏—è —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏:
  - Navigational: `diversity=1`, `boost_hierarchy=true`
  - How-to: `diversity=3`, `expand_context=true`
  - Factual: `diversity=3`, `expand_context=true`

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞ –∑–∞–ø—Ä–æ—Å–∞

### –§–∏–Ω–∞–ª—å–Ω–∞—è —Ñ–æ—Ä–º—É–ª–∞ —Ä–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏—è:

```python
final_score = (
    rerank_score * 1.0 +        # CrossEncoder (–≤–µ—Å 100%)
    hierarchy_boost * 0.3 +      # –í–∞–∂–Ω–æ—Å—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—ã (–≤–µ—Å 30%)
    breadcrumb_boost * 0.2       # –°–æ–≤–ø–∞–¥–µ–Ω–∏–µ –ø—É—Ç–∏ (–≤–µ—Å 20%)
)
```

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:

- –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Å–µ—Ö –≤—Ö–æ–¥–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
- –ó–∞—â–∏—Ç–∞ –æ—Ç SQL/NoSQL injection (regex –¥–ª—è space)
- –õ–∏–º–∏—Ç—ã –Ω–∞ –¥–ª–∏–Ω—É query (2-1000 —Å–∏–º–≤–æ–ª–æ–≤)
- –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è limit (1-20)
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏

## –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

–°–µ—Ä–≤–µ—Ä –ª–æ–≥–∏—Ä—É–µ—Ç –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –Ω–∞ –∫–∞–∂–¥–æ–º —ç—Ç–∞–ø–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–∞ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ —É–∑–∫–∏—Ö –º–µ—Å—Ç.

**–ú–µ—Ç—Ä–∏–∫–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è:**

- –í—Ä–µ–º—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ embeddings –¥–ª—è –∑–∞–ø—Ä–æ—Å–∞
- –í—Ä–µ–º—è –≤–µ–∫—Ç–æ—Ä–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞ –≤ ChromaDB
- –í—Ä–µ–º—è reranking (CrossEncoder)
- –í—Ä–µ–º—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
- –û–±—â–µ–µ –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–∞

**–ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤:**

```bash
docker logs confluence-rag | grep -E "TIMING|Cache|Fallback|PRF"
```

**–ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞:**

```
[INFO] Cache MISS: '—Å—Ç–µ–∫ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π RAUII...', –≤—ã–ø–æ–ª–Ω—è—é –ø–æ–∏—Å–∫...
[INFO] Query intent: exploratory (diversity=2, expand_context=True)
[INFO] Query expansion: —Å—Ç–µ–∫ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π RAUII ‚Üí ['—Å—Ç–µ–∫ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π RAUII', '—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫ RAUII', ...]
[INFO] –ù–∞–π–¥–µ–Ω–æ 35 —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤, –ø–æ—Å–ª–µ deduplication: 28
[INFO] Reranking 28 –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤...
[INFO] ‚úÖ Cache HIT: '—Å—Ç–µ–∫ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π RAUII...' (0.8 —Å–µ–∫)
```

## –û—Ç–ª–∞–¥–∫–∞

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤

```bash
docker logs -f confluence-rag
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ MCP —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞
curl http://localhost:8012/mcp

# –ü—Ä–æ–≤–µ—Ä–∫–∞ health
curl http://localhost:8012/health

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
docker exec confluence-rag python -c "from mcp_rag_secure import collection; print(f'Documents: {collection.count()}')"
```

### –ü–æ–ª–Ω—ã–π –ø–µ—Ä–µ—Å–±–æ—Ä –∏–Ω–¥–µ–∫—Å–∞

```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
docker compose down

# –£–¥–∞–ª–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ
rm -rf chroma_data sync_state.json data/

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ –∑–∞–Ω–æ–≤–æ
docker compose up -d
```

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- **API —Ç–æ–∫–µ–Ω**: —Ö—Ä–∞–Ω–∏—Ç–µ `.env` –≤ —Å–µ–∫—Ä–µ—Ç–µ, –¥–æ–±–∞–≤—å—Ç–µ –≤ `.gitignore`
- **–°–µ—Ç—å**: –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ Docker networks –¥–ª—è –∏–∑–æ–ª—è—Ü–∏–∏
- **SSL**: –≤–∫–ª—é—á–∞–π—Ç–µ `VERIFY_SSL=true` –¥–ª—è production
- **–ü—Ä–∞–≤–∞**: –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ–¥ UID –ø—Ä–æ—Ü–µ—Å—Å–∞ Python
- **–í–∞–ª–∏–¥–∞—Ü–∏—è**: –≤—Å–µ –≤—Ö–æ–¥–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤–∞–ª–∏–¥–∏—Ä—É—é—Ç—Å—è –∏ —Å–∞–Ω–∏—Ç–∏–∑–∏—Ä—É—é—Ç—Å—è

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

- **–ë–∞—Ç—á–∏–Ω–≥**: `BATCH_SIZE=50` –æ–ø—Ç–∏–º–∞–ª–µ–Ω –¥–ª—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ —Å–ª—É—á–∞–µ–≤
- **Chunking**: `CHUNK_SIZE=512` - –±–∞–ª–∞–Ω—Å –º–µ–∂–¥—É –¥–µ—Ç–∞–ª—å–Ω–æ—Å—Ç—å—é –∏ —Å–∫–æ—Ä–æ—Å—Ç—å—é
- **–°–ø–µ–π—Å—ã**: –æ–≥—Ä–∞–Ω–∏—á—å—Ç–µ `CONFLUENCE_SPACE_FILTER` –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è –ø–µ—Ä–≤–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
- **–≠–º–±–µ–¥–¥–∏–Ω–≥–∏**: HuggingFace –±—ã—Å—Ç—Ä–µ–µ –¥–ª—è –º–∞–ª—ã—Ö –æ–±—ä—ë–º–æ–≤, Ollama - –¥–ª—è –±–æ–ª—å—à–∏—Ö
- **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ**: –≤–∫–ª—é—á–∏—Ç–µ `USE_REDIS_CACHE=true` –¥–ª—è production (–µ—Å–ª–∏ –µ—Å—Ç—å Redis)

### –¢–∏–ø–∏—á–Ω–æ–µ –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–∞

| –¢–∏–ø –∑–∞–ø—Ä–æ—Å–∞ | –ü–µ—Ä–≤—ã–π –∑–∞–ø—Ä–æ—Å | Cache HIT |
|-------------|---------------|-----------|
| –ö–æ—Ä–æ—Ç–∫–∏–π (2-3 —Å–ª–æ–≤–∞) | ~8-12 —Å–µ–∫ | ~0.8 —Å–µ–∫ |
| –°—Ä–µ–¥–Ω–∏–π (4-6 —Å–ª–æ–≤) | ~5-8 —Å–µ–∫ | ~0.8 —Å–µ–∫ |
| –î–ª–∏–Ω–Ω—ã–π (7+ —Å–ª–æ–≤) | ~3-5 —Å–µ–∫ | ~0.8 —Å–µ–∫ |

### –¢–∏–ø–∏—á–Ω–æ–µ –≤—Ä–µ–º—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

| –û–±—ä—ë–º | –ü–µ—Ä–≤–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è | –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–∞—è |
|-------|---------------------|-----------------|
| 100 —Å—Ç—Ä–∞–Ω–∏—Ü | ~2-5 –º–∏–Ω | ~10-30 —Å–µ–∫ |
| 500 —Å—Ç—Ä–∞–Ω–∏—Ü | ~10-20 –º–∏–Ω | ~30-60 —Å–µ–∫ |
| 1000+ —Å—Ç—Ä–∞–Ω–∏—Ü | ~30-60 –º–∏–Ω | ~1-3 –º–∏–Ω |

## –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

–û—Å–Ω–æ–≤–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –ø—Ä–æ–µ–∫—Ç–∞:

- **FastMCP** 2.13+ ‚Äî MCP —Å–µ—Ä–≤–µ—Ä–Ω–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞
- **LlamaIndex** 0.10+ ‚Äî RAG —Ñ—Ä–µ–π–º–≤–æ—Ä–∫
- **ChromaDB** 0.4+ ‚Äî –≤–µ–∫—Ç–æ—Ä–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- **SentenceTransformers** 2.3+ ‚Äî –¥–ª—è HuggingFace —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤
- **Transformers** 4.35+ ‚Äî –¥–ª—è –º–æ–¥–µ–ª–µ–π
- **Torch** 2.0+ ‚Äî –¥–ª—è ML –≤—ã—á–∏—Å–ª–µ–Ω–∏–π
- **httpx** ‚Äî –¥–ª—è HTTP –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ Confluence API
- **python-dotenv** ‚Äî –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
- **OpenAI** 1.0+ ‚Äî –¥–ª—è OpenAI-compatible API (Ollama, LM Studio)
- **redis** (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) ‚Äî –¥–ª—è Redis –∫—ç—à–∞

–ü–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π —Å–º. –≤ `requirements.txt`.

> **üí° –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Embedding –ú–æ–¥–µ–ª–µ–π**: –ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ OpenRouter, Ollama –∏ HuggingFace –¥–ª—è embedding –º–æ–¥–µ–ª–µ–π –¥–æ—Å—Ç—É–ø–Ω–∞ –≤ [OLLAMA_SETUP.md](OLLAMA_SETUP.md).

## –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
confluence-rag-project/
‚îú‚îÄ‚îÄ docker-compose.yml                          # Docker Compose –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ Dockerfile.standalone                       # –û–±—Ä–∞–∑ –¥–ª—è standalone —Ä–µ–∂–∏–º–∞
‚îú‚îÄ‚îÄ README.md                                   # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îú‚îÄ‚îÄ requirements.txt                            # Python –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ .env                                        # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (—Å–æ–∑–¥–∞–π—Ç–µ —Å–∞–º–∏)
‚îú‚îÄ‚îÄ chroma_data/                                # –ë–∞–∑–∞ ChromaDB (–∞–≤—Ç–æ—Å–æ–∑–¥–∞—ë—Ç—Å—è)
‚îú‚îÄ‚îÄ data/                                       # –î–∞–Ω–Ω—ã–µ (–∫—ç—à, —Å–∏–Ω–æ–Ω–∏–º—ã, –ª–æ–≥–∏)
‚îÇ   ‚îú‚îÄ‚îÄ semantic_cache.json                     # In-Memory –∫—ç—à
‚îÇ   ‚îú‚îÄ‚îÄ domain_terms.json                       # –î–æ–º–µ–Ω–Ω—ã–µ —Ç–µ—Ä–º–∏–Ω—ã
‚îÇ   ‚îú‚îÄ‚îÄ learned_synonyms.json                   # –í—ã—É—á–µ–Ω–Ω—ã–µ —Å–∏–Ω–æ–Ω–∏–º—ã
‚îÇ   ‚îî‚îÄ‚îÄ query_log.json                          # –ò—Å—Ç–æ—Ä–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤
‚îî‚îÄ‚îÄ rag_server/
    ‚îú‚îÄ‚îÄ mcp_rag_secure.py                        # MCP —Å–µ—Ä–≤–µ—Ä + –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ (1335 —Å—Ç—Ä–æ–∫)
    ‚îú‚îÄ‚îÄ sync_confluence_optimized_final.py       # –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è Confluence (894 —Å—Ç—Ä–æ–∫–∏)
    ‚îú‚îÄ‚îÄ embeddings.py                            # –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –º–æ–¥—É–ª—å —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤
    ‚îú‚îÄ‚îÄ synonyms_manager.py                     # –ú–µ–Ω–µ–¥–∂–µ—Ä —Å–∏–Ω–æ–Ω–∏–º–æ–≤ (400 —Å—Ç—Ä–æ–∫)
    ‚îú‚îÄ‚îÄ semantic_cache.py                       # –°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –∫—ç—à (250 —Å—Ç—Ä–æ–∫)
    ‚îî‚îÄ‚îÄ advanced_search.py                      # –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π –ø–æ–∏—Å–∫ (200 —Å—Ç—Ä–æ–∫)
```

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–ü—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç pytest –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è. –ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –≤ [tests/README.md](tests/README.md).

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Ç–µ—Å—Ç—ã
make test

# –¢–µ—Å—Ç—ã —Å coverage
make test-cov

# –¢–æ–ª—å–∫–æ unit —Ç–µ—Å—Ç—ã
make test-unit

# –¢–æ–ª—å–∫–æ integration —Ç–µ—Å—Ç—ã
make test-integration
```

**–ù–æ–≤—ã–µ —Ç–µ—Å—Ç—ã:**
- `tests/test_embeddings.py` - —Ç–µ—Å—Ç—ã –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥–µ–ª–µ–π, –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–∑–º–µ—Ä–Ω–æ—Å—Ç–∏, –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è fallback
- `tests/test_dimension_validation.py` - —Ç–µ—Å—Ç—ã –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–∑–º–µ—Ä–Ω–æ—Å—Ç–∏ –≤ sync –∏ mcp_rag_secure

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ –∫–æ–¥–∞

```bash
# –ü–æ–ª–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ (—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ + –ø—Ä–æ–≤–µ—Ä–∫–∏ + —Ç–µ—Å—Ç—ã)
make quality

# –ò–ª–∏ –ø–æ –æ—Ç–¥–µ–ª—å–Ω–æ—Å—Ç–∏:
make format        # –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞ (Black)
make sort-imports  # –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –∏–º–ø–æ—Ä—Ç–æ–≤ (isort)
make lint          # –í—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ (Black, isort, Flake8, MyPy)
make type-check    # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–æ–≤ (MyPy)
make style-check   # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∏–ª—è (Flake8)
```

**–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã:**
- **Black** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞
- **isort** - —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –∏–º–ø–æ—Ä—Ç–æ–≤
- **Flake8** - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∏–ª—è –∫–æ–¥–∞ (PEP 8)
- **MyPy** - —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–æ–≤
- **pytest** - —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- **pytest-cov** - –∏–∑–º–µ—Ä–µ–Ω–∏–µ –ø–æ–∫—Ä—ã—Ç–∏—è –∫–æ–¥–∞

**–¶–µ–ª–µ–≤–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ:** 70%+

## –ò—Å—Ç–æ—Ä–∏—è –≤–µ—Ä—Å–∏–π

- **2.1.0** ‚Äî –î–æ–±–∞–≤–ª–µ–Ω—ã Self-Learning Synonyms, Semantic Caching, PRF, Query Rewriting, Content Type Detection, Query Intent Classification
- **2.0.0** ‚Äî –î–æ–±–∞–≤–ª–µ–Ω—ã 9 –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π –ø–æ–∏—Å–∫–∞ (Query Expansion, Adaptive Rerank, Metadata Pre-filtering, Fallback, Deduplication, Reranking, Context Expansion, Hierarchy Boost, Breadcrumb Matching)
- **1.0.0** ‚Äî –ü–µ—Ä–≤—ã–π —Ä–µ–ª–∏–∑ —Å –±–∞–∑–æ–≤—ã–º —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–º –ø–æ–∏—Å–∫–æ–º

## –õ–∏—Ü–µ–Ω–∑–∏—è

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è–µ—Ç—Å—è –ø–æ–¥ –ª–∏—Ü–µ–Ω–∑–∏–µ–π MIT. –ü–æ–¥—Ä–æ–±–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é —Å–º–æ—Ç—Ä–∏—Ç–µ –≤ —Ñ–∞–π–ª–µ LICENSE (–µ—Å–ª–∏ –µ—Å—Ç—å) –∏–ª–∏ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏.

## –û –ø—Ä–æ–µ–∫—Ç–µ

**Confluence RAG** ‚Äî –æ—Ç–∫—Ä—ã—Ç—ã–π –ø—Ä–æ–µ–∫—Ç –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–æ–∏—Å–∫–∞ –ø–æ Confluence —Å AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞–º–∏ —á–µ—Ä–µ–∑ MCP –ø—Ä–æ—Ç–æ–∫–æ–ª.

---

**–†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π**: [GitHub](https://github.com/your-org/confluence-rag)  
**Docker Hub**: [Docker Hub](https://hub.docker.com/r/your-org/confluence-rag)
